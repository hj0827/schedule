import{r as P,$ as L,A as S,a as $,a0 as te,o as H,d as ne,j as oe,g as l,x as se,c as d,e as D,f as a,w as t,u as o,l as p,y as B,z as v,F as z,i as O,_ as ae}from"./index-DFxeWJFZ.js";import re from"./ImportUser-BSboPE7m.js";import{_ as le}from"./AddUser.vue_vue_type_script_setup_true_lang-CJbMmZf9.js";import{E as T,D as ie}from"./BaseEnum-DZksv6ke.js";import{u as ce}from"./useInstance-MikN16Nm.js";import"./useDialog-Dl2BjXS6.js";import"./xlsx-uoQkVabA.js";import"./index-2NxJnuEc.js";function de(h,g){const{global:y}=ce(),n=P(),u=P();return{addRef:n,addBtn:()=>{n.value.show(T.ADD)},editBtn:i=>{n.value.show(T.EDIT,i)},deleteBtn:async i=>{if(await y.$myconfirm()){let r=await L(i.userId);r&&r.code==200?(S.success(r.msg),h()):S.error(r.msg)}},save:async i=>{console.log(i)},importBtn:async()=>{u.value.show(T.ImportUser)},importRef:u,deleteSelectedUsers:async()=>{const i=await y.$myconfirm();if(g.value.length===0){S.warning("请选中要删除的数据");return}if(i){let s=!0;for(const r of g.value)try{const _=await L(r);_&&_.code===200?console.log(`User with key ${r} deleted successfully.`):(console.error(`Failed to delete user with key ${r}:`,_.msg),s=!1)}catch(_){console.error(`Failed to delete user with key ${r}:`,_),s=!1}s?(S.success("所有选中的用户都已成功删除"),h(),g.value=[]):S.error("部分用户删除失败，请检查日志")}}}}function ue(){const h=P(0),g=[{title:"姓名",dataIndex:"name",key:"name"},{title:"电话",dataIndex:"phone",key:"phone"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"性别",dataIndex:"sex",key:"sex"},{title:"登录账户",dataIndex:"username",key:"username"},{title:"操作",dataIndex:"action",key:"action",align:"center",width:220}],y=$({list:[]}),n=$({pageSize:10,currentPage:1,phone:"",name:""}),u=$({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:[10,20,30,40],showQuickJumper:!0,showTotal:s=>`共有${s} 条数据`,onChange:(s,r)=>{n.currentPage=s,n.pageSize=r,u.current=s,u.pageSize=r,c()}}),c=async()=>{const s=await te(n);s&&s.code==200&&(y.list=s.data.records,u.total=s.data.total)},I=$({current:1}),b=()=>{I.current=1,n.currentPage=1,c(),sessionStorage.setItem("searchState",JSON.stringify(n))},R=()=>{n.phone="",n.name="",n.currentPage=1,c(),sessionStorage.removeItem("searchState")},w=()=>{c()},m=P([]),i=s=>{m.value=s};return H(()=>{c(),h.value=window.innerHeight-310}),{tableHeight:h,tableList:y,listParm:n,page:u,getList:c,columns:g,searchBtn:b,resetBtn:R,refresh:w,selectedRowKeys:m,onSelectChange:i}}const me=ne({__name:"User",setup(h){oe();const{tableHeight:g,tableList:y,listParm:n,page:u,getList:c,columns:I,resetBtn:b,searchBtn:R,refresh:w,selectedRowKeys:m,onSelectChange:i}=ue(),{addBtn:s,editBtn:r,deleteBtn:_,save:pe,addRef:J,importBtn:K,importRef:V,deleteSelectedUsers:j}=de(c,m),M=x=>({onClick:()=>{const e=m.value.indexOf(x.userId);e>-1?m.value.splice(e,1):m.value.push(x.userId)}});return H(()=>{document.title=ie.user;const x=sessionStorage.getItem("searchState");x&&(Object.assign(n,JSON.parse(x)),c())}),(x,e)=>{const N=l("a-input"),A=l("a-form-item"),Q=l("SearchOutlined"),k=l("a-button"),q=l("reload-outlined"),G=l("PlusOutlined"),W=l("vertical-align-top-outlined"),E=l("delete-outlined"),X=l("a-form"),F=l("a-tag"),Y=l("edit-outlined"),Z=l("a-table"),C=se("permission");return d(),D(z,null,[a(X,{layout:"inline",style:{"margin-bottom":"15px"}},{default:t(()=>[a(A,null,{default:t(()=>[a(N,{value:o(n).name,"onUpdate:value":e[0]||(e[0]=f=>o(n).name=f),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),a(A,null,{default:t(()=>[a(N,{value:o(n).phone,"onUpdate:value":e[1]||(e[1]=f=>o(n).phone=f),placeholder:"请输入电话"},null,8,["value"])]),_:1}),a(k,{onClick:o(R),style:{"margin-right":"10px"}},{icon:t(()=>[a(Q)]),default:t(()=>[e[2]||(e[2]=p(" 搜索 "))]),_:1},8,["onClick"]),a(k,{onClick:o(b),type:"danger",style:{"margin-right":"10px"}},{icon:t(()=>[a(q)]),default:t(()=>[e[3]||(e[3]=p(" 重置 "))]),_:1},8,["onClick"]),B((d(),v(k,{type:"primary",onClick:o(s),style:{"margin-right":"10px"}},{icon:t(()=>[a(G)]),default:t(()=>[e[4]||(e[4]=p(" 新增 "))]),_:1},8,["onClick"])),[[C,["sys:user:add"]]]),B((d(),v(k,{type:"primary",onClick:o(K),style:{"margin-right":"10px"},class:"importBtn"},{icon:t(()=>[a(W)]),default:t(()=>[e[5]||(e[5]=p(" 导入 "))]),_:1},8,["onClick"])),[[C,["sys:user:add"]]]),B((d(),v(k,{type:"danger",onClick:o(j),style:{"margin-right":"10px"}},{icon:t(()=>[a(E)]),default:t(()=>[e[6]||(e[6]=p(" 删除选中 "))]),_:1},8,["onClick"])),[[C,["sys:user:delete"]]])]),_:1}),a(Z,{dataSource:o(y).list,pagination:o(u),columns:o(I),scroll:{y:o(g)},"row-selection":{selectedRowKeys:o(m),onChange:o(i),type:"checkbox"},rowKey:f=>f.userId,onRow:M},{bodyCell:t(({column:f,record:U})=>[f.key==="sex"?(d(),D(z,{key:0},[U.sex==0?(d(),v(F,{key:0,color:"green"},{default:t(()=>e[7]||(e[7]=[p("男")])),_:1})):O("",!0),U.sex==1?(d(),v(F,{key:1,color:"red"},{default:t(()=>e[8]||(e[8]=[p("女")])),_:1})):O("",!0)],64)):O("",!0),f.dataIndex==="action"?(d(),D(z,{key:1},[B((d(),v(k,{onClick:ee=>o(r)(U),style:{"margin-right":"10px"},type:"primary"},{icon:t(()=>[a(Y)]),default:t(()=>[e[9]||(e[9]=p(" 编辑 "))]),_:2},1032,["onClick"])),[[C,["sys:user:edit"]]]),B((d(),v(k,{onClick:ee=>o(_)(U),type:"danger"},{icon:t(()=>[a(E)]),default:t(()=>[e[10]||(e[10]=p(" 删除 "))]),_:2},1032,["onClick"])),[[C,["sys:user:delete"]]])],64)):O("",!0)]),_:1},8,["dataSource","pagination","columns","scroll","row-selection","rowKey"]),a(le,{ref_key:"addRef",ref:J,onRefresh:o(w)},null,8,["onRefresh"]),a(re,{ref_key:"importRef",ref:V,onRefresh:o(w)},null,8,["onRefresh"])],64)}}}),we=ae(me,[["__scopeId","data-v-092c35f2"]]);export{we as default};
