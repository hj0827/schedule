import{u as I,_ as C}from"./useDialog-Dl2BjXS6.js";import{G as d,r as g,a as K,d as D,g as N,c as v,z as k,w as T,u as a,Y as x,i as L,A as w,Z as S}from"./index-DFxeWJFZ.js";const $=e=>d.post({url:"/api/role",data:e}),z=e=>d.get({url:"/api/role/list",params:e}),G=e=>d.put({url:"/api/role",data:e}),V=e=>d.delete({url:`/api/role/${e}`}),b=e=>d.get({url:"/api/role/getAssingShow",params:e}),E=e=>d.post({url:"/api/role/assignSave",data:e});function O(){const e=g(),m=g(!0),o=g([]),h=K({children:"children",title:"title",key:"menuId"}),u=g([]),p=async r=>{let l=await b(r);if(l&&l.code===200&&(u.value=l.data.menuList,o.value=l.data.checkList),o.value.length>0){let s=[];o.value.forEach(t=>{f(t,u.value,s)}),o.value=s}},f=(r,l,s)=>{l.forEach(t=>{t.menuId==r?t.children&&t.children.length==0&&s.push(t.menuId):t.children&&t.children.length!=0&&f(r,t.children,s)})};return{assignTree:e,showLine:m,checkedKeys:o,fieldNames:h,treeData:u,getTreeData:p}}const Y=D({__name:"AssignRole",setup(e,{expose:m}){const o=g(),{assignTree:h,showLine:u,checkedKeys:p,fieldNames:f,treeData:r,getTreeData:l}=O(),{dialog:s,onClose:t,onShow:_}=I(),y=async()=>{const c=h.value.checkedKeys.concat(h.value.halfCheckedKeys);let i={roleId:o.value,list:c},n=await E(i);n&&n.code==200?(w.success(n.msg),t()):w.error(n.msg)};return m({show:c=>{o.value=c.roleId,s.title="为【"+c.roleName+"】分配权限",s.height=450,s.width=300;const i=S()||"";if(!i){console.error("用户ID无效");return}const n={userId:i,roleId:c.roleId};console.log("请求参数:",n),l(n),_()}}),(c,i)=>{const n=N("a-tree");return v(),k(C,{title:a(s).title,width:a(s).width,height:a(s).height,visible:a(s).visible,onOnClose:a(t),onOnConfirm:y},{content:T(()=>[a(r)&&a(r).length>0?(v(),k(n,{key:0,ref_key:"assignTree",ref:h,class:"myTree",checkable:"",defaultExpandAll:"","show-line":a(u),"tree-data":a(r),fieldNames:a(f),checkedKeys:a(p),"onUpdate:checkedKeys":i[0]||(i[0]=A=>x(p)?p.value=A:null)},null,8,["show-line","tree-data","fieldNames","checkedKeys"])):L("",!0)]),_:1},8,["title","width","height","visible","onOnClose"])}}});export{Y as _,$ as a,V as d,G as e,z as g};
