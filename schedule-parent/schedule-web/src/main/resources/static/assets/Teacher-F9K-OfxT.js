import{_ as W}from"./AddTeacher.vue_vue_type_script_setup_true_lang-D43g3Vlq.js";import{E as D,D as X}from"./BaseEnum-DZksv6ke.js";import{G as B,r as N,A as f,a as $,o as F,H as Y,d as Z,g as d,x as ee,c as _,e as z,f as l,w as o,u as s,l as v,y as b,z as x,F as O,i as te}from"./index-DFxeWJFZ.js";import{u as ne}from"./useInstance-MikN16Nm.js";import"./useDialog-Dl2BjXS6.js";const ae=t=>B.post({url:"/api/teacher",data:t}),oe=t=>B.get({url:"/api/teacher/list",params:t}),se=t=>B.put({url:"/api/teacher",data:t}),E=t=>B.delete({url:`/api/teacher/${t}`});function re(t){const{global:n}=ne(),g=N(),u=N([]);return{addBtn:()=>{var e;(e=g.value)==null||e.show(D.ADD)},editBtn:e=>{var a;(a=g.value)==null||a.show(D.EDIT,e)},deleteBtn:async e=>{if(await n.$myconfirm()){let i=await E(e.teacherId);i&&i.code===200&&(f.success(i.msg),t())}},save:async e=>{console.log("父组件接收数据"),console.log(e);let a=null;e.type===D.ADD?a=await ae(e):a=await se(e),a&&a.code===200&&(f.success(a.msg),t())},addRef:g,deleteSelectedTeachers:async()=>{if(await n.$myconfirm()){if(u.value.length===0){f.warning("请选中要删除的数据");return}let a=!0;for(const i of u.value)try{const p=await E(i);p&&p.code===200?console.log(`Teacher with ID ${i} deleted successfully.`):(console.error(`Failed to delete teacher with ID ${i}:`,p.msg),f.error(`教师 ${i} 删除失败: ${p.msg}`),a=!1)}catch(p){console.error(`Failed to delete teacher with ID ${i}:`,p),f.error(`教师 ${i} 删除失败: ${p.message||"未知错误"}`),a=!1}a?(f.success("所有选中的教师都已成功删除"),t(),u.value=[]):f.error("部分教师删除失败，请检查日志")}},onSelectChange:e=>{u.value=e},selectedTeacherIds:u}}function ce(){const t=N(0),n=$({currentPage:1,pageSize:10,teacherName:""}),g=$({list:[]}),u=[{title:"教师姓名",key:"teacherName",dataIndex:"teacherName"},{title:"教师编号",key:"teacherNum",dataIndex:"teacherNum"},{title:"备注",key:"teacherDesc",dataIndex:"teacherDesc"},{title:"操作",key:"action",align:"center",width:220}],h=$({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50"],showTotal:c=>`共有${c}条数据`,onChange:(c,w)=>{n.currentPage=c,n.pageSize=w,h.current=c,h.pageSize=w,m()}}),m=async()=>{let c=await oe(n);c&&c.code==200&&(console.log(c),g.list=c.data.records,h.total=c.data.total)},k=()=>{h.current=1,n.currentPage=1,m(),sessionStorage.setItem("savedteacher",JSON.stringify(n))},S=()=>{n.teacherName="",n.currentPage=1,m(),sessionStorage.removeItem("savedteacher")};return F(()=>{m(),Y(()=>{t.value=window.innerHeight-310})}),{listParm:n,tableList:g,columns:u,rolePage:h,getList:m,tableHeight:t,resetBtn:S,searchBtn:k}}const pe=Z({__name:"Teacher",setup(t){const{listParm:n,rolePage:g,columns:u,tableList:h,getList:m,tableHeight:k,searchBtn:S,resetBtn:c}=ce(),{addBtn:w,editBtn:e,deleteBtn:a,addRef:i,save:p,deleteSelectedTeachers:H,onSelectChange:R,selectedTeacherIds:L}=re(m);return F(()=>{document.title=X.teacher;const I=sessionStorage.getItem("savedteacher");I&&(Object.assign(n,JSON.parse(I)),m())}),(I,r)=>{const V=d("a-input"),J=d("a-form-item"),K=d("SearchOutlined"),y=d("a-button"),j=d("reload-outlined"),G=d("plus-outlined"),P=d("delete-outlined"),M=d("a-form"),U=d("edit-outlined"),q=d("a-table"),C=ee("permission");return _(),z(O,null,[l(M,{layout:"inline",style:{"margin-bottom":"14px"}},{default:o(()=>[l(J,{label:"教师名称"},{default:o(()=>[l(V,{value:s(n).teacherName,"onUpdate:value":r[0]||(r[0]=T=>s(n).teacherName=T),placeholder:"请输入教师名称"},null,8,["value"])]),_:1}),l(y,{onClick:s(S),style:{"margin-right":"15px"}},{icon:o(()=>[l(K)]),default:o(()=>[r[1]||(r[1]=v(" 搜索 "))]),_:1},8,["onClick"]),l(y,{onClick:s(c),type:"danger",style:{"margin-right":"15px"}},{icon:o(()=>[l(j)]),default:o(()=>[r[2]||(r[2]=v(" 重置 "))]),_:1},8,["onClick"]),b((_(),x(y,{onClick:s(w),type:"primary",style:{"margin-right":"15px"}},{icon:o(()=>[l(G)]),default:o(()=>[r[3]||(r[3]=v(" 新增 "))]),_:1},8,["onClick"])),[[C,["sys:teacher:add"]]]),b((_(),x(y,{onClick:s(H),type:"danger",style:{"margin-right":"15px"}},{icon:o(()=>[l(P)]),default:o(()=>[r[4]||(r[4]=v(" 删除选中 "))]),_:1},8,["onClick"])),[[C,["sys:teacher:delete"]]])]),_:1}),l(q,{scroll:{y:s(k)},bordered:"",dataSource:s(h).list,pagination:s(g),columns:s(u),"row-selection":{selectedRowKeys:s(L),onChange:s(R),type:"checkbox"},rowKey:"teacherId"},{bodyCell:o(({column:T,record:A})=>[T.key=="action"?(_(),z(O,{key:0},[b((_(),x(y,{onClick:Q=>s(e)(A),style:{"margin-right":"15px"},type:"primary"},{icon:o(()=>[l(U)]),default:o(()=>[r[5]||(r[5]=v(" 编辑 "))]),_:2},1032,["onClick"])),[[C,["sys:teacher:edit"]]]),b((_(),x(y,{onClick:Q=>s(a)(A),type:"danger"},{icon:o(()=>[l(P)]),default:o(()=>[r[6]||(r[6]=v(" 删除 "))]),_:2},1032,["onClick"])),[[C,["sys:teacher:delete"]]])],64)):te("",!0)]),_:1},8,["scroll","dataSource","pagination","columns","row-selection"]),l(W,{ref_key:"addRef",ref:i,onSave:s(p)},null,8,["onSave"])],64)}}});export{pe as default};
