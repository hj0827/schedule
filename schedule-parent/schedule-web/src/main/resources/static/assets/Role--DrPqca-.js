import{E as D,D as Y}from"./BaseEnum-DZksv6ke.js";import{d as z,a as Z,e as ee,g as te,_ as oe}from"./AssignRole.vue_vue_type_style_index_0_lang-CMDjMBkn.js";import{u as ne}from"./useInstance-MikN16Nm.js";import{r as R,A as d,a as I,o as H,H as se,d as le,g as c,x as ae,c as k,e as E,f as n,w as e,u as l,l as v,y as B,z as h,F,i as ie,_ as re}from"./index-DFxeWJFZ.js";import{_ as ce}from"./AddRole.vue_vue_type_script_setup_true_lang-BDJCu3NO.js";import"./useDialog-Dl2BjXS6.js";import"./index-2NxJnuEc.js";function de(f,u){const w=R(),{global:m}=ne(),a=R();return{addBtn:()=>{a.value.show(D.ADD)},editBtn:o=>{a.value.show(D.EDIT,o)},deleteBtn:async o=>{if(await m.$myconfirm()){const r=await z(o.roleId);r.code===200?(d.success(r.msg),f()):d.error(r.msg)}},save:async o=>{console.log(o);let s;o.type===D.ADD?s=await Z(o):o.type===D.EDIT&&(s=await ee(o)),s&&s.code===200?(d.success(s.msg),f()):s?d.error(s.msg):d.error("操作失败")},addRef:a,assignRef:w,assignBtn:o=>{w.value.show(o)},deleteSelectedRoles:async()=>{const o=await m.$myconfirm();if(u.value.length===0){d.warning("请选中要删除的角色");return}if(o){let s=!0;for(const r of u.value)try{const y=await z(r);y.code===200?console.log(`Role with key ${r} deleted successfully.`):(console.error(`Failed to delete role with key ${r}:`,y.msg),s=!1)}catch(y){console.error(`Failed to delete role with key ${r}:`,y),d.error(`角色 ${r} 删除失败: ${y.message||"未知错误"}`),s=!1}s?(d.success("所有选中的角色都已成功删除"),f(),u.value=[]):d.error("部分角色删除失败，请检查日志")}}}}function ue(){const f=R(0),u=I({list:[]}),w=[{title:"角色名称",dataIndex:"roleName",key:"roleName"},{title:"角色描述",dataIndex:"roleDesc",key:"roleDesc"},{title:"操作",dataIndex:"action",key:"action",width:340}],m=I({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50"],showTotal:i=>`共有${i}条数据`,onChange:(i,g)=>{a.currentPage=i,a.pageSize=g,m.current=i,m.pageSize=g,p()}}),a=I({pageSize:10,currentPage:1,roleName:""}),p=async()=>{let i=await te(a);i&&i.code===200&&(u.list=i.data.records)},S=()=>{p()},b=()=>{a.currentPage=1,a.roleName="",p()};return H(()=>{p(),se(()=>{f.value=window.innerHeight-300})}),{tableHeight:f,tableList:u,columns:w,listParm:a,rolePage:m,getList:p,resetBtn:b,searchBtn:S}}const me=le({__name:"Role",setup(f){const{tableHeight:u,tableList:w,columns:m,listParm:a,rolePage:p,getList:S,resetBtn:b,searchBtn:i}=ue(),g=R([]),N=T=>{g.value=T},{addBtn:o,editBtn:s,deleteBtn:r,save:y,addRef:L,assignRef:O,assignBtn:V,deleteSelectedRoles:K}=de(S,g);return H(()=>{document.title=Y.role}),(T,t)=>{const M=c("a-input"),U=c("a-form-item"),j=c("SearchOutlined"),_=c("a-button"),q=c("reload-outlined"),G=c("plus-outlined"),A=c("delete-outlined"),J=c("a-form"),Q=c("edit-outlined"),W=c("lock-outlined"),X=c("a-table"),C=ae("permission");return k(),E(F,null,[n(J,{layout:"inline",style:{"margin-bottom":"10px"}},{default:e(()=>[n(U,null,{default:e(()=>[n(M,{value:l(a).roleName,"onUpdate:value":t[0]||(t[0]=x=>l(a).roleName=x),placeholder:"请输入角色名称"},null,8,["value"])]),_:1}),n(_,{onClick:l(i),style:{"margin-right":"15px"}},{icon:e(()=>[n(j)]),default:e(()=>[t[1]||(t[1]=v(" 搜索 "))]),_:1},8,["onClick"]),n(_,{onClick:l(b),style:{"margin-right":"15px"},type:"danger"},{icon:e(()=>[n(q)]),default:e(()=>[t[2]||(t[2]=v(" 重置 "))]),_:1},8,["onClick"]),B((k(),h(_,{onClick:l(o),type:"primary",style:{"margin-right":"15px"}},{icon:e(()=>[n(G)]),default:e(()=>[t[3]||(t[3]=v(" 新增 "))]),_:1},8,["onClick"])),[[C,["sys:role:add"]]]),B((k(),h(_,{onClick:l(K),type:"danger",style:{"margin-right":"15px"}},{icon:e(()=>[n(A)]),default:e(()=>[t[4]||(t[4]=v(" 删除选中 "))]),_:1},8,["onClick"])),[[C,["sys:role:delete"]]])]),_:1}),n(X,{dataSource:l(w).list,pagination:l(p),columns:l(m),scroll:{y:l(u)},"row-selection":{selectedRowKeys:g.value,onChange:N,type:"checkbox"},rowKey:x=>x.roleId},{bodyCell:e(({column:x,record:$})=>[x.dataIndex==="action"?(k(),E(F,{key:0},[B((k(),h(_,{onClick:P=>l(s)($),style:{"margin-right":"10px"},type:"primary"},{icon:e(()=>[n(Q)]),default:e(()=>[t[5]||(t[5]=v(" 编辑 "))]),_:2},1032,["onClick"])),[[C,["sys:role:edit"]]]),B((k(),h(_,{onClick:P=>l(V)($),style:{"margin-right":"10px"},type:"primary"},{icon:e(()=>[n(W)]),default:e(()=>[t[6]||(t[6]=v(" 分配权限 "))]),_:2},1032,["onClick"])),[[C,["sys:role:permission"]]]),B((k(),h(_,{onClick:P=>l(r)($),type:"danger"},{icon:e(()=>[n(A)]),default:e(()=>[t[7]||(t[7]=v(" 删除 "))]),_:2},1032,["onClick"])),[[C,["sys:role:delete"]]])],64)):ie("",!0)]),_:1},8,["dataSource","pagination","columns","scroll","row-selection","rowKey"]),n(ce,{ref_key:"addRef",ref:L,onSave:l(y)},null,8,["onSave"]),n(oe,{ref_key:"assignRef",ref:O},null,512)],64)}}}),we=re(me,[["__scopeId","data-v-d8daedbd"]]);export{we as default};
