import{u as B,_ as k}from"./useDialog-Dl2BjXS6.js";import{d as D,r as S,g as i,c as j,z as L,w as f,h as t,f as d,l as w,u as p,A as x,cC as O,_ as V}from"./index-DFxeWJFZ.js";import{r as E,u as F}from"./xlsx-uoQkVabA.js";const P={class:"downloadBtn"},R={class:"ant-upload-drag-icon"},T="/src/assets/ExcelTemplates/ImportUserData.xlsx",z=D({__name:"ImportUser",emits:["refresh"],setup($,{expose:v,emit:y}){const m=S([]);let n=null;const b=({file:o,fileList:e})=>{o.status==="removed"?n=null:o.status!=="uploading"&&console.log(o,e)},C=o=>(n=o,!1),{dialog:c,onClose:g,onShow:U}=B();v({show:async(o,e)=>{U()}});const A=y,I=async()=>{if(!n){x.warning("请选择一个文件");return}const o=new FileReader;o.onload=async e=>{var r;const a=(r=e.target)==null?void 0:r.result;if(a instanceof ArrayBuffer){const l=E(new Uint8Array(a),{type:"array"}),u=l.SheetNames[0],_=l.Sheets[u],N=F.sheet_to_json(_).map(s=>({username:s.账户,password:s.密码,name:s.姓名,roleId:s["角色【系统管理员：1，普通管理员：2，任课教师：3，助学老师&学生：4】"],__rowNum__:s.__rowNum__}));try{const s=await O(N);x.success("用户导入成功"),console.log("API Response:",s),A("refresh")}catch(s){s.response?s.response.data.msg:s.message;const h=s.response?s.response.data.data:[];h.length>0&&console.log("Existing Users:",h)}}},o.readAsArrayBuffer(n),g()};return(o,e)=>{const a=i("vertical-align-bottom-outlined"),r=i("a-button"),l=i("inbox-outlined"),u=i("a-upload-dragger");return j(),L(k,{title:"导入用户名单",width:p(c).width,height:p(c).height,visible:p(c).visible,onOnConfirm:I,onOnClose:p(g)},{content:f(()=>[t("div",P,[e[2]||(e[2]=t("div",null,"模板：",-1)),t("div",null,[t("a",{href:T,download:"ImportUserData.xlsx"},[d(r,{type:"primary"},{default:f(()=>[d(a),e[1]||(e[1]=w(" 下载模板 "))]),_:1})])])]),e[4]||(e[4]=t("div",{class:"downColor"},[w(" 说明："),t("span",null,"请严格按模板填写，否则可能导致无法准确导入。")],-1)),d(u,{"file-list":m.value,"onUpdate:fileList":e[0]||(e[0]=_=>m.value=_),"before-upload":C,onChange:b},{default:f(()=>[t("p",R,[d(l)]),e[3]||(e[3]=t("p",{class:"ant-upload-text"},"点击或者拖拽到该区域上传",-1))]),_:1},8,["file-list"])]),_:1},8,["width","height","visible","onOnClose"])}}}),M=V(z,[["__scopeId","data-v-0ff5a22c"]]);export{M as default};
