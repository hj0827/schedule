import{n as j,o as q,p as x,b as R,h as J}from"./schedule-eMs4Cjr4.js";import{r as c,o as z,a as b,M,H as _}from"./index-DFxeWJFZ.js";function K(v,l){const g=c([]),w=c([]),s=c([]),u=c([]),m=async()=>{let a=await j();a&&a.code==200&&(w.value=a.data)},T=async()=>{let a=await q();a&&a.code==200&&(g.value=a.data)},C=async()=>{let a=await x();a&&a.code==200&&(s.value=a.data.map(r=>({value:r.value,label:`${r.label} - ${r.courseType}`,isMergeClasses:r.isMergeClasses})))},p=async()=>{let a=await x();a&&a.code==200&&(console.log("课程列表："+JSON.stringify(a.data,null,2)),u.value=a.data.filter(r=>r.parentCourseId===null||r.parentCourseId===void 0||r.parentCourseId==="").map(r=>({value:r.value,label:`${r.label} - ${r.courseType}`,courseType:a.data,isMergeClasses:r.isMergeClasses})))},f=async()=>{let a=await R(l);a&&a.code==200&&console.log("已排课程的列表："+JSON.stringify(a.data,null,2))},S=(a,r)=>r.label.toLowerCase().indexOf(a.toLowerCase())>=0,k=(a,r)=>r.label.toLowerCase().indexOf(a.toLowerCase())>=0,A=(a,r)=>r.label.toLowerCase().indexOf(a.toLowerCase())>=0;return z(()=>{m(),T(),C(),p()}),{filterTeacheroption:S,filterRoomOption:k,filterCourseOption:A,courseOptions:s,teacherOptions:w,roomOptions:g,courseOptionsPaike:u,getPaikeCourseList:f}}function B(){const v=c(0),l=b({list:[]}),g=c([]),w=[{title:"课程名称",dataIndex:"courseName",key:"courseName",align:"center"},{title:"课时名称",dataIndex:"lessonName",key:"lessonName",align:"center"},{title:"专业名称",dataIndex:"majorName",key:"majorName",align:"center"},{title:"考期",dataIndex:"courseType",key:"courseType",align:"center",width:220},{title:"远智课程ID",dataIndex:"yuanzhiCourseId",key:"yuanzhiCourseId",align:"center",width:120},{title:"教师",dataIndex:"teacherName",key:"teacherName",align:"center",width:80},{title:"上课日期",dataIndex:"dateTime",key:"dateTime",align:"center",width:110},{title:"上课时间",dataIndex:"beginTime",key:"beginTime",customRender:({text:e})=>{if(!e)return"--";try{const[t,n]=e.split(":");return`${t.padStart(2,"0")}:${n}`}catch{return console.warn("无效的上课时间格式:",e),e||"--"}},width:90,align:"center"},{title:"下课时间",dataIndex:"endTime",key:"endTime",customRender:({text:e})=>{if(!e)return"--";try{const[t,n]=e.split(":");return`${t.padStart(2,"0")}:${n}`}catch{return console.warn("无效的下课时间格式:",e),e||"--"}},align:"center",width:90},{title:"直播间",dataIndex:"roomName",key:"roomName",align:"center",width:90},{title:"操作",align:"center",key:"action",width:220}],s=b({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50","500"],showTotal:e=>`共有${e}条数据`,onChange:(e,t)=>{u.currentPage=e,u.pageSize=t,s.current=e,s.pageSize=t,r()}}),u=b({roomIdList:[],courseIdList:[],teacherIdList:[],startDate:"",endDate:"",beginTime:"",endTime:"",duration:"",courseName:"",courseType:"",currentPage:1,teacherName:"",delId:"",teacherId:"",roomId:"",lessonName:""}),m=c(!1),T=c([]),C=c([]),p=c(!1),f=c(!1),S=()=>{p.value=!p.value},k=()=>{f.value=!f.value},A=M(()=>{const e=new Map;return T.value.forEach(t=>{const n=`${t.dateTime}_${t.beginTime}_${t.endTime}`;e.has(n)||e.set(n,t)}),Array.from(e.values())}),a=M(()=>{const e=new Map;return C.value.forEach(t=>{const n=`${t.dateTime}_${t.beginTime}_${t.endTime}`;e.has(n)||e.set(n,t)}),Array.from(e.values())}),r=async()=>{m.value=!0;try{let e=await R(u);if(console.log("API响应数据:",JSON.stringify(e,null,2)),!e){console.warn("API 响应为空"),l.list=[],s.total=0;return}if(e.code!==200){console.warn("API 响应状态码不是 200:",e.code),l.list=[],s.total=0;return}let t=[],n=0;if(!e.data){console.warn("API 响应中没有 data 字段"),l.list=[],s.total=0;return}if(Array.isArray(e.data))t=e.data,n=t.length,console.log("数据是数组格式，长度:",t.length);else if(typeof e.data=="object")if(Array.isArray(e.data.records))t=e.data.records,n=e.data.total||t.length,console.log("数据在 records 字段中，长度:",t.length,"总数:",n);else if(Array.isArray(e.data.list))t=e.data.list,n=e.data.total||t.length,console.log("数据在 list 字段中，长度:",t.length,"总数:",n);else{console.warn("在响应中未找到有效的数据数组"),l.list=[],s.total=0;return}else{console.warn("响应数据格式不正确"),l.list=[],s.total=0;return}if(!Array.isArray(t)){console.warn("提取的记录不是数组"),l.list=[],s.total=0;return}if(t.length===0){console.log("记录数组为空"),l.list=[],s.total=0;return}const y=t.filter(o=>{if(!o||typeof o!="object")return console.warn("无效的记录:",o),!1;const i=["courseName","teacherName","dateTime","beginTime","endTime"].filter(h=>!o[h]);return i.length>0?(console.warn(`记录缺少必要字段 ${i.join(", ")}:`,o),!1):!0});if(y.length===0){console.warn("没有有效的记录数据"),l.list=[],s.total=0;return}console.log("有效记录数:",y.length),console.log("第一条记录示例:",JSON.stringify(y[0],null,2)),y.sort((o,d)=>{const i=(o.courseName||"").localeCompare(d.courseName||"");if(i!==0)return i;const h=(o.courseType||"").localeCompare(d.courseType||"");if(h!==0)return h;const O=(o.teacherName||"").localeCompare(d.teacherName||"");if(O!==0)return O;const D=(o.dateTime||"").localeCompare(d.dateTime||"");if(D!==0)return D;const P=(o.beginTime||"").localeCompare(d.beginTime||"");return P!==0?P:(o.endTime||"").localeCompare(d.endTime||"")});const I=new Map,L=[];y.forEach(o=>{o.delId?(I.has(o.delId)||I.set(o.delId,[]),I.get(o.delId).push(o)):L.push(o)});const N=[],$=[];I.forEach((o,d)=>{if(o.length>1){const i=o[0];i.key=i.id;const h=o.slice(1);i.children=h,i.isParent=!0,N.push(i),$.push(i.key)}else N.push(o[0])}),N.push(...L),l.list=N,s.total=n,g.value=$}catch(e){console.error("获取数据失败:",e),e instanceof Error&&(console.error("错误详情:",e.message),console.error("错误堆栈:",e.stack)),l.list=[],s.total=0}finally{m.value=!1}},E=async e=>{console.log(`selected ${e}`),u.courseId=e;try{let t=await J(u);if(t&&t.code===200)return t.data}catch(t){console.error("获取课程排程信息失败",t)}return[]};return z(()=>{r(),_(()=>{v.value=window.innerHeight-300})}),{tableHeight:v,tableList:l,rolePage:s,listParm:u,columns:w,getList:r,loading:m,handleCourseChange:E,expandedRowKeys:g,uniqueRoomScheduleData:A,uniqueTeacherScheduleData:a,showRoomScheduleDetails:p,toggleRoomScheduleDetails:S,showTeacherScheduleDetails:f,toggleTeacherScheduleDetails:k,roomScheduleData:T,teacherScheduleData:C}}export{K as a,B as u};
