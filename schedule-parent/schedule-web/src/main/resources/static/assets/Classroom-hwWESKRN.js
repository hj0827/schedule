import{G as b,r as R,A as y,a as O,o as H,H as Y,d as Z,g as u,x as ee,c as S,e as A,f as l,w as s,u as n,l as k,y as B,z as I,F as T,I as z,h as E,i as te}from"./index-DFxeWJFZ.js";import{E as P,D as oe}from"./BaseEnum-DZksv6ke.js";import{_ as se}from"./Add.vue_vue_type_script_setup_true_lang-BTH8b6Bb.js";import{u as ne}from"./useInstance-MikN16Nm.js";import"./useDialog-Dl2BjXS6.js";import"./index-2NxJnuEc.js";const ae=e=>b.post({url:"/api/classroom",data:e}),re=e=>b.get({url:"/api/classroom/list",params:e}),le=e=>b.put({url:"/api/classroom",data:e}),F=e=>b.delete({url:`/api/classroom/${e}`});function ie(e){const{global:f}=ne(),g=R(),r=R([]);return{addBtn:()=>{var t;(t=g.value)==null||t.show(P.ADD)},editBtn:t=>{var o;(o=g.value)==null||o.show(P.EDIT,t)},deleteBtn:async t=>{if(await f.$myconfirm()){let c=await F(t.roomId);c&&c.code===200&&(y.success(c.msg),e())}},save:async t=>{let o=null;t.type===P.ADD?o=await ae(t):o=await le(t),o&&o.code===200&&(y.success(o.msg),e())},addRef:g,deleteSelectedRooms:async()=>{if(await f.$myconfirm()){if(r.value.length===0){y.warning("请选中要删除的数据");return}let o=!0;for(const c of r.value)try{const p=await F(c);p&&p.code===200?console.log(`Room with ID ${c} deleted successfully.`):(console.error(`Failed to delete room with ID ${c}:`,p.msg),y.error(`教室 ${c} 删除失败: ${p.msg}`),o=!1)}catch(p){console.error(`Failed to delete room with ID ${c}:`,p),y.error(`教室 ${c} 删除失败: ${p.message||"未知错误"}`),o=!1}o?(y.success("所有选中的教室都已成功删除"),e(),r.value=[]):y.error("部分教室删除失败，请检查日志")}},onSelectChange:t=>{r.value=t},selectedRoomIds:r}}function ce(){const e=R(0),f=O({list:[]}),g=[{title:"直播间名称",key:"roomName",dataIndex:"roomName"},{title:"直播间地址",key:"roomAddress",dataIndex:"roomAddress"},{title:"操作",key:"action",align:"center",width:220}],r=O({total:0,current:1,showSizeChanger:!0,pageSize:10,name:"",pageSizeOptions:["10","20","30","40"],showTotal:i=>`共有${i}条数据`,onChange:(i,h)=>{r.current=i,r.pageSize=h,m.currentPage=i,m.pageSize=h,d()}}),m=O({pageSize:10,currentPage:1,roomName:""}),d=async()=>{let i=await re(m);i&&i.code===200&&(f.list=i.data.records,r.total=i.data.total)},w=()=>{r.current=1,m.currentPage=1,d(),sessionStorage.setItem("classroomSearchParm",JSON.stringify(m))},C=()=>{m.roomName="",m.currentPage=1,d(),sessionStorage.removeItem("classroomSearchParm")};return H(()=>{d(),Y(()=>{e.value=window.innerHeight-310})}),{tableHeight:e,tableList:f,columns:g,rolePage:r,listParm:m,getList:d,resetBtn:C,searchBtn:w}}const ye=Z({__name:"Classroom",setup(e){const{tableHeight:f,tableList:g,columns:r,rolePage:m,listParm:d,getList:w,searchBtn:C,resetBtn:i}=ce(),{addBtn:h,editBtn:t,deleteBtn:o,addRef:c,save:p,deleteSelectedRooms:V,onSelectChange:L,selectedRoomIds:J}=ie(w);return H(()=>{document.title=oe.ClassRoom;const x=sessionStorage.getItem("classroomSearchParm");x&&(Object.assign(d,JSON.parse(x)),w())}),(x,a)=>{const K=u("a-input"),M=u("a-form-item"),j=u("SearchOutlined"),_=u("a-button"),G=u("ReloadOutlined"),U=u("PlusOutlined"),$=u("DeleteOutlined"),q=u("a-form"),Q=u("EditOutlined"),W=u("a-table"),v=ee("permission");return S(),A(T,null,[l(q,{layout:"inline",style:{"margin-bottom":"14px"}},{default:s(()=>[l(M,null,{default:s(()=>[l(K,{value:n(d).roomName,"onUpdate:value":a[0]||(a[0]=D=>n(d).roomName=D),placeholder:"请输入教室名称"},null,8,["value"])]),_:1}),l(_,{onClick:n(C),style:{"margin-right":"15px"}},{icon:s(()=>[l(j)]),default:s(()=>[a[1]||(a[1]=k(" 搜索 "))]),_:1},8,["onClick"]),l(_,{onClick:n(i),style:{"margin-right":"15px"},type:"danger"},{icon:s(()=>[l(G)]),default:s(()=>[a[2]||(a[2]=k(" 重置 "))]),_:1},8,["onClick"]),B((S(),I(_,{onClick:n(h),type:"primary",style:{"margin-right":"15px"}},{icon:s(()=>[l(U)]),default:s(()=>[a[3]||(a[3]=k(" 新增 "))]),_:1},8,["onClick"])),[[v,["sys:classroom:add"]]]),B((S(),I(_,{onClick:n(V),type:"danger",style:{"margin-right":"15px"}},{icon:s(()=>[l($)]),default:s(()=>[a[4]||(a[4]=k(" 删除选中 "))]),_:1},8,["onClick"])),[[v,["sys:classroom:delete"]]])]),_:1}),l(W,{dataSource:n(g).list,columns:n(r),pagination:n(m),scroll:{y:n(f)},bordered:"","row-selection":{selectedRowKeys:n(J),onChange:n(L),type:"checkbox"},rowKey:"roomId"},{bodyCell:s(({column:D,record:N})=>[D.key==="action"?(S(),A(T,{key:0},[B((S(),I(_,{type:"primary",onClick:z(X=>n(t)(N),["stop"])},{icon:s(()=>[l(Q)]),default:s(()=>[a[5]||(a[5]=E("span",null,"编辑",-1))]),_:2},1032,["onClick"])),[[v,["sys:classroom:edit"]]]),B((S(),I(_,{type:"danger",style:{"margin-left":"10px"},onClick:z(X=>n(o)(N),["stop"])},{icon:s(()=>[l($)]),default:s(()=>[a[6]||(a[6]=E("span",null,"删除",-1))]),_:2},1032,["onClick"])),[[v,["sys:classroom:delete"]]])],64)):te("",!0)]),_:1},8,["dataSource","columns","pagination","scroll","row-selection"]),l(se,{ref_key:"addRef",ref:c,onSave:n(p)},null,8,["onSave"])],64)}}});export{ye as default};
