import{E as R,D as ee}from"./BaseEnum-DZksv6ke.js";import te from"./AddCourse-CbrGedHe.js";import{G as K,r as E,a as P,o as J,H as oe,A as T,d as se,g as m,x as ne,c as u,e as D,f as p,w as r,u as l,l as _,y as M,z as S,F as $,i as I,B as re,_ as ae}from"./index-DFxeWJFZ.js";import{u as le}from"./useInstance-MikN16Nm.js";import"./MergeCourseForm-CzmyxNaA.js";import"./index-2NxJnuEc.js";import"./useDialog-Dl2BjXS6.js";const ce=s=>K.post({url:"/api/course",data:JSON.stringify(s),headers:{"Content-Type":"application/json"}}),ie=s=>K.get({url:"/api/course/list",params:s}),ue=s=>K.put({url:"/api/course",data:JSON.stringify(s),headers:{"Content-Type":"application/json"}}),H=s=>(console.log("删除课程id"+s),K.delete({url:`/api/course/${s}`}));function de(){const s=E(0),g=P({list:[]}),C=E([]),x=[{title:"课程名称",dataIndex:"courseName",key:"courseName"},{title:"专业名称",dataIndex:"majorName",key:"majorName"},{title:"考期",dataIndex:"courseType",key:"courseType"},{title:"学年",dataIndex:"courseYear",key:"courseYear",width:65},{title:"远智课程ID",dataIndex:"yuanzhiCourseId",key:"yuanzhiCourseId",width:120},{title:"合并上课",dataIndex:"isMergeClasses",key:"isMergeClasses",width:90},{title:"背景色",dataIndex:"courseColor",key:"courseColor",width:75},{title:"操作",align:"center",key:"action",width:220}],c=P({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50","500"],showTotal:o=>`共有${o}条数据`,onChange:(o,n)=>{f.currentPage=o,f.pageSize=n,c.current=o,c.pageSize=n,v()}}),f=P({courseName:"",courseType:"",currentPage:c.current,pageSize:c.pageSize}),v=async()=>{let o=await ie(f);if(o&&o.code===200){console.log(o);const n=o.data.total,y=z(o.data.records);g.list=y,C.value=o.data.records.filter(h=>h.parentCourseId===null||h.parentCourseId==="").map(h=>h.courseId),c.total=n}},z=o=>{const n=new Map,y=[];o.forEach(d=>{n.set(d.courseId,{...d,children:[]})}),o.forEach(d=>{if(d.parentCourseId){const e=n.get(d.parentCourseId);e?e.children.push(n.get(d.courseId)):y.push(n.get(d.courseId))}else y.push(n.get(d.courseId))});const h=d=>d.map(e=>(e.children.length===0?delete e.children:e.children=h(e.children),e));return h(y)},N=(o,n)=>{if(o)C.value.push(n.courseId);else{const y=C.value.indexOf(n.courseId);y>-1&&C.value.splice(y,1)}};return J(()=>{v(),oe(()=>{s.value=window.innerHeight-310})}),{tableHeight:s,tableList:g,rolePage:c,listParm:f,columns:x,getList:v,expandedRowKeys:C,onExpand:N}}function pe(s,g){const{global:C}=le(),x=E(),c=E([]),f=()=>{var e;(e=x.value)==null||e.show(R.ADD)},v=e=>{var a;(a=x.value)==null||a.show(R.EDIT,e)},z=async e=>{if(await C.$myconfirm()){let i=await H(e.courseId);i&&i.code===200&&(T.success(i.msg),s())}},N=async e=>{console.log("保存的数据",e);let a=null;try{e.length>0?(e[0].type===R.ADD?a=await ce(e):e[0].type===R.EDIT&&(a=await ue(e)),a&&a.code===200&&(T.success(a.msg),s())):console.warn("没有数据需要保存")}catch(i){console.error("保存课程时发生错误:",i)}},o=async()=>{if(await C.$myconfirm()){if(c.value.length===0){T.warning("请选中要删除的数据");return}let a=!0;for(const i of c.value)try{const w=await H(i);w&&w.code===200?console.log(`Course with ID ${i} deleted successfully.`):(console.error(`Failed to delete course with ID ${i}:`,w.msg),T.error(`课程 ${i} 删除失败: ${w.msg}`),a=!1)}catch(w){console.error(`Failed to delete course with ID ${i}:`,w),T.error(`课程 ${i} 删除失败: ${w.message||"未知错误"}`),a=!1}a?(T.success("所有选中的课程都已成功删除"),s(),c.value=[]):T.error("部分课程删除失败，请检查日志")}},n=P({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50"],showTotal:e=>`共有${e}条数据`,onChange:(e,a)=>{g.currentPage=e,g.pageSize=a,n.current=e,n.pageSize=a,s()}});return{addBtn:f,editBtn:v,deleteBtn:z,save:N,addRef:x,searchBtn:()=>{n.current=1,g.currentPage=1,s()},resetBtn:()=>{g.courseName="",g.courseType="",g.currentPage=1,s()},deleteSelectedCourses:o,onSelectChange:e=>{c.value=e},selectedCourseIds:c}}const ge=se({__name:"Course",setup(s){const{rolePage:g,tableList:C,columns:x,tableHeight:c,listParm:f,getList:v,expandedRowKeys:z,onExpand:N}=de();E([{label:"春季",value:"0"},{label:"秋季",value:"1"}]);const{addBtn:o,editBtn:n,deleteBtn:y,save:h,addRef:d,searchBtn:e,resetBtn:a,deleteSelectedCourses:i,onSelectChange:w,selectedCourseIds:V}=pe(v,f);return J(()=>{document.title=ee.course;const j=sessionStorage.getItem("courseSearchParm");j&&(Object.assign(f,JSON.parse(j)),v())}),(j,t)=>{const Y=m("a-input"),G=m("a-form-item"),U=m("SearchOutlined"),b=m("a-button"),q=m("reload-outlined"),L=m("plus-outlined"),F=m("delete-outlined"),Q=m("a-form"),O=m("a-tag"),W=m("edit-outlined"),X=m("a-table"),A=ne("permission");return u(),D($,null,[p(Q,{layout:"inline",style:{"margin-bottom":"10px"}},{default:r(()=>[p(G,{label:"课程名称"},{default:r(()=>[p(Y,{value:l(f).courseName,"onUpdate:value":t[0]||(t[0]=B=>l(f).courseName=B),placeholder:"请输入课程名称"},null,8,["value"])]),_:1}),p(b,{onClick:l(e),class:"margin-left"},{icon:r(()=>[p(U)]),default:r(()=>[t[1]||(t[1]=_(" 搜索 "))]),_:1},8,["onClick"]),p(b,{onClick:l(a),type:"danger",class:"margin-left"},{icon:r(()=>[p(q)]),default:r(()=>[t[2]||(t[2]=_(" 重置 "))]),_:1},8,["onClick"]),M((u(),S(b,{onClick:l(o),type:"primary",class:"margin-left"},{icon:r(()=>[p(L)]),default:r(()=>[t[3]||(t[3]=_(" 新增 "))]),_:1},8,["onClick"])),[[A,["sys:course:add"]]]),M((u(),S(b,{onClick:l(i),type:"danger",class:"margin-left"},{icon:r(()=>[p(F)]),default:r(()=>[t[4]||(t[4]=_(" 删除选中 "))]),_:1},8,["onClick"])),[[A,["sys:course:delete"]]])]),_:1}),p(X,{dataSource:l(C).list,columns:l(x),pagination:l(g),bordered:"",scroll:{y:l(c)},rowKey:"courseId",indentSize:15,"row-selection":{selectedRowKeys:l(V),onChange:l(w),type:"checkbox"},expandedRowKeys:l(z),onExpand:l(N)},{bodyCell:r(({column:B,record:k})=>[B.key==="courseType"?(u(),D($,{key:0},[k.courseType==="0"?(u(),S(O,{key:0,color:"green"},{default:r(()=>t[5]||(t[5]=[_("春季")])),_:1})):I("",!0),k.courseType==="1"?(u(),S(O,{key:1,color:"blue"},{default:r(()=>t[6]||(t[6]=[_("秋季")])),_:1})):I("",!0)],64)):I("",!0),B.key==="isMergeClasses"?(u(),D($,{key:1},[k.isMergeClasses==="0"?(u(),S(O,{key:0,color:"green"},{default:r(()=>t[7]||(t[7]=[_("否")])),_:1})):I("",!0),k.isMergeClasses==="1"?(u(),S(O,{key:1,color:"red"},{default:r(()=>t[8]||(t[8]=[_("是")])),_:1})):I("",!0)],64)):I("",!0),B.key==="courseColor"?(u(),D($,{key:2},[k.courseColor?(u(),D("div",{key:0,style:re({height:"20px",width:"100%",backgroundColor:k.courseColor.substring(k.courseColor.indexOf("-")+1,k.courseColor.length)})},null,4)):I("",!0)],64)):I("",!0),B.key==="action"?(u(),D($,{key:3},[M((u(),S(b,{onClick:Z=>l(n)(k),type:"primary"},{icon:r(()=>[p(W)]),default:r(()=>[t[9]||(t[9]=_(" 编辑 "))]),_:2},1032,["onClick"])),[[A,["sys:course:edit"]]]),M((u(),S(b,{onClick:Z=>l(y)(k),style:{"margin-left":"10px"},type:"danger"},{icon:r(()=>[p(F)]),default:r(()=>[t[10]||(t[10]=_(" 删除 "))]),_:2},1032,["onClick"])),[[A,["sys:course:delete"]]])],64)):I("",!0)]),_:1},8,["dataSource","columns","pagination","scroll","row-selection","expandedRowKeys","onExpand"]),p(te,{onSave:l(h),ref_key:"addRef",ref:d},null,8,["onSave"])],64)}}}),we=ae(ge,[["__scopeId","data-v-a6dd8d09"]]);export{we as default};
