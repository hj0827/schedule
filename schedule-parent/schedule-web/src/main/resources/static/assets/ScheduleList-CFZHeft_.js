import{L as ee}from"./loadingOverlay-BZind_yn.js";import{u as F,w as te}from"./xlsx-uoQkVabA.js";import{_ as oe}from"./EditSchedule.vue_vue_type_script_setup_true_lang-BTMHw6Mx.js";import{u as re}from"./useTable-C-JI8HsX.js";import{E as ne,D as se}from"./BaseEnum-DZksv6ke.js";import{u as ae}from"./useInstance-MikN16Nm.js";import{d as G,a as le}from"./schedule-eMs4Cjr4.js";import{r as z,A as w,d as ie,a as ce,o as ue,c as u,e as $,f as n,u as o,w as r,F as U,g as d,x as de,l as g,y as K,z as x,i as S,B as me,_ as pe}from"./index-DFxeWJFZ.js";import"./useDialog-Dl2BjXS6.js";import"./index-2NxJnuEc.js";function ye(b,O,C){const{global:E}=ae(),_=z(!1),m=z();return{editBtn:N=>{var y;(y=m.value)==null||y.show(ne.EDIT,N)},deleteBtn:async N=>{if(await E.$myconfirm())try{_.value=!0;const s=await G(String(N.id));s&&s.code===200?(w.success(s.msg||"删除成功"),b()):w.error(s.msg||"删除失败")}catch(s){console.error("删除失败:",s),w.error("删除失败，请稍后重试")}finally{_.value=!1}},addRef:m,searchBtn:()=>{b()},resetBtn:()=>{Object.assign(O,{courseName:"",courseType:"",teacherIdList:[],startDate:"",endDate:"",beginTime:"",endTime:"",teacherName:""}),b()},deleteSelectedUsers:async()=>{if(C.value.length===0){w.warning("请选中要删除的数据");return}if(await E.$myconfirm()){_.value=!0;try{let y=!0;for(const s of C.value)try{const D=typeof s=="string"&&s.includes("-")?await le(String(s)):await G(String(s));D&&D.code===200?console.log(`课程 ${s} 删除成功`):(console.error(`删除课程 ${s} 失败:`,D.msg),y=!1)}catch(R){console.error(`删除课程 ${s} 失败:`,R),y=!1}y?(w.success("所有选中的课程都已成功删除"),b(),C.value=[]):w.error("部分课程删除失败，请检查日志")}finally{_.value=!1}}},loading1:_}}const fe=ie({__name:"ScheduleList",setup(b){const{rolePage:O,tableList:C,columns:E,tableHeight:_,listParm:m,getList:V,loading:H,expandedRowKeys:P}=re(),M=c=>{P.value=c},I=z([]),N=c=>{I.value=c},{loading1:y,editBtn:s,addRef:R,searchBtn:D,resetBtn:J,deleteBtn:Q,deleteSelectedUsers:W}=ye(V,m,I),Y=(c,t=[])=>(c.forEach(i=>{const p={...i};delete p.children,t.push(p),i.children&&Array.isArray(i.children)&&Y(i.children,t)}),t);ce({id:0,roomId:0,courseId:"",teacherId:"",dateTime:"",beginTime:"",duration:0,endTime:"",courseType:"",majorName:"",courseYear:"",teacherName:"",courseName:"",roomName:"",courseColor:"",roomAddress:"",startDate:"",endDate:""});const X=()=>{const c=[{key:"课程分类",title:"课程分类"},{key:"courseType",title:"第一考期"},{key:"学期",title:"学期"},{key:"courseName",title:"课程名称"},{key:"课程id",title:"课程id"},{key:"阶段名称",title:"阶段名称"},{key:"lessonName",title:"课时名称"},{key:"上课方式",title:"上课方式"},{key:"回放有效期",title:"回放有效期"},{key:"teacherName",title:"教师"},{key:"dateTime",title:"上课日期"},{key:"beginTime",title:"上课时间"},{key:"endTime",title:"下课时间"},{key:"视频VIDS（上课方式为硬盘推流时填写）",title:"视频VIDS（上课方式为硬盘推流时填写）"},{key:"腾讯云回放链接（上课方式为录播时填写）",title:"腾讯云回放链接（上课方式为录播时填写）"},{key:"答疑区话题",title:"答疑区话题"},{key:"上课基数",title:"上课基数"},{key:"聊天室",title:"聊天室"},{key:"私聊",title:"私聊"},{key:"是否启用",title:"是否启用"},{key:"课后打卡",title:"课后打卡"},{key:"课后打卡说明",title:"课后打卡说明"},{key:"发布圈子",title:"发布圈子"},{key:"绑定话题",title:"绑定话题"},{key:"majorName",title:"专业名称"},{key:"startDate",title:"开课日期（用于贴到在线表）"},{key:"duration",title:"时长"},{key:"courseYear",title:"学年"},{key:"roomName",title:"直播间名称"}],t=Y(C.list);t.sort((e,a)=>{if(e.teacherName!==a.teacherName)return(e.teacherName||"").localeCompare(a.teacherName||"");if(e.courseName!==a.courseName)return(e.courseName||"").localeCompare(a.courseName||"");if(e.courseType!==a.courseType){const h=e.courseType==="0"?"春季":e.courseType==="1"?"秋季":e.courseType||"",f=a.courseType==="0"?"春季":a.courseType==="1"?"秋季":a.courseType||"";return h.localeCompare(f)}return e.dateTime!==a.dateTime?(e.dateTime||"").localeCompare(a.dateTime||""):e.beginTime!==a.beginTime?(e.beginTime||"").localeCompare(a.beginTime||""):(e.endTime||"").localeCompare(a.endTime||"")});const i=[c.map(e=>e.title)];t.forEach((e,a)=>{const h=e.lessonName,f=q(e.beginTime),B=q(e.endTime),L=e.dateTime&&f&&B?`${h}：${e.dateTime}【${f}-${B}】`:h,j=c.map(A=>{switch(A.key){case"课程分类":return"常规课";case"上课方式":return"直播";case"回放有效期":return"17520";case"上课基数":return"0";case"聊天室":return"启用";case"私聊":return"禁用";case"是否启用":return"是";case"课后打卡":return"启用";case"课后打卡说明":return"课后打卡";case"发布圈子":return"自考圈";case"答疑区话题":return e.teacherDesc?e.teacherDesc+"答疑专区":"";case"lessonName":const k=e.courseName||"",l=e.lessonName||h||"";return k&&l?`${k}${l}`:l||k;case"beginTime":return f;case"endTime":return B;case"startDate":return L;case"courseType":return e.courseType==="0"?"春季":e.courseType==="1"?"秋季":e.courseType||"";case"阶段名称":return e.stageDescription||"";default:return e[A.key]||""}});i.push(j)});const p=F.aoa_to_sheet(i),v=F.book_new();F.book_append_sheet(v,p,"Sheet1"),te(v,"schedule_list.xlsx")},q=c=>{const[t,i]=c.split(":").map(Number),p=t.toString().padStart(2,"0"),v=i.toString().padStart(2,"0");return`${p}:${v}`};return ue(()=>{document.title=se.ScheduleList}),(c,t)=>{const i=d("a-input"),p=d("a-form-item"),v=d("SearchOutlined"),e=d("a-button"),a=d("reload-outlined"),h=d("file-excel-outlined"),f=d("delete-outlined"),B=d("a-form"),L=d("a-tag"),j=d("edit-outlined"),A=d("a-table"),k=de("permission");return u(),$(U,null,[n(ee,{visible:o(H)||o(y)},null,8,["visible"]),n(B,{layout:"inline",style:{"margin-bottom":"14px"}},{default:r(()=>[n(p,{label:"课程名称"},{default:r(()=>[n(i,{value:o(m).courseName,"onUpdate:value":t[0]||(t[0]=l=>o(m).courseName=l),placeholder:"请输入课程名称"},null,8,["value"])]),_:1}),n(p,{label:"考期"},{default:r(()=>[n(i,{value:o(m).courseType,"onUpdate:value":t[1]||(t[1]=l=>o(m).courseType=l),placeholder:"请输入考期"},null,8,["value"])]),_:1}),n(p,{label:"教师"},{default:r(()=>[n(i,{value:o(m).teacherName,"onUpdate:value":t[2]||(t[2]=l=>o(m).teacherName=l),placeholder:"请输入教师名称"},null,8,["value"])]),_:1}),n(e,{onClick:o(D),class:"margin-left"},{icon:r(()=>[n(v)]),default:r(()=>[t[3]||(t[3]=g(" 搜索 "))]),_:1},8,["onClick"]),n(e,{onClick:o(J),type:"danger",class:"margin-left"},{icon:r(()=>[n(a)]),default:r(()=>[t[4]||(t[4]=g(" 重置 "))]),_:1},8,["onClick"]),K((u(),x(e,{onClick:X,type:"primary",class:"margin-left"},{icon:r(()=>[n(h)]),default:r(()=>[t[5]||(t[5]=g(" 导出课时 "))]),_:1})),[[k,["sys:scheduleList:export"]]]),K((u(),x(e,{type:"danger",onClick:o(W),style:{"margin-right":"10px"},class:"margin-left"},{icon:r(()=>[n(f)]),default:r(()=>[t[6]||(t[6]=g(" 删除选中 "))]),_:1},8,["onClick"])),[[k,["sys:schedule:delete"]]])]),_:1}),n(A,{dataSource:o(C).list,columns:o(E),pagination:o(O),bordered:"",scroll:{y:o(_)},"row-selection":{selectedRowKeys:I.value,onChange:N,type:"checkbox"},rowKey:l=>l.id,expandedRowKeys:o(P),onExpandedRowsChange:M},{bodyCell:r(({column:l,record:T})=>[l.key==="courseType"?(u(),$(U,{key:0},[T.courseType==="0"?(u(),x(L,{key:0,color:"green"},{default:r(()=>t[7]||(t[7]=[g("春季")])),_:1})):S("",!0),T.courseType==="1"?(u(),x(L,{key:1,color:"blue"},{default:r(()=>t[8]||(t[8]=[g("秋季")])),_:1})):S("",!0)],64)):S("",!0),l.key==="courseColor"?(u(),$(U,{key:1},[T.courseColor?(u(),$("div",{key:0,style:me({height:"20px",width:"100%",backgroundColor:T.courseColor.substring(T.courseColor.indexOf("-")+1,T.courseColor.length)})},null,4)):S("",!0)],64)):S("",!0),l.key==="action"?(u(),$(U,{key:2},[K((u(),x(e,{onClick:Z=>o(s)(T),type:"primary"},{icon:r(()=>[n(j)]),default:r(()=>[t[9]||(t[9]=g(" 编辑 "))]),_:2},1032,["onClick"])),[[k,["sys:course:edit"]]]),K((u(),x(e,{onClick:Z=>o(Q)(T),style:{"margin-left":"10px"},type:"danger"},{icon:r(()=>[n(f)]),default:r(()=>[t[10]||(t[10]=g(" 删除 "))]),_:2},1032,["onClick"])),[[k,["sys:schedule:delete"]]])],64)):S("",!0)]),_:1},8,["dataSource","columns","pagination","scroll","row-selection","rowKey","expandedRowKeys"]),n(oe,{ref_key:"addRef",ref:R,onRefreshList:o(V)},null,8,["onRefreshList"])],64)}}}),Se=pe(fe,[["__scopeId","data-v-15641186"]]);export{Se as default};
