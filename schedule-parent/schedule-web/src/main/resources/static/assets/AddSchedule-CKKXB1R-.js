import{d as bt,r as b,a as ke,b as g,M as de,L as _t,o as wt,H as $e,c as v,z as K,w as i,u as _,A as T,g as C,f as r,h as m,J as le,l as M,i as Q,t as w,e as k,K as W,F as X,O as Ye,P as Me,B as kt,Q as Ct,I as St,N as Ae,_ as Dt}from"./index-DFxeWJFZ.js";import{L as Ht}from"./loadingOverlay-BZind_yn.js";import{u as It,_ as xt}from"./useDialog-Dl2BjXS6.js";import{u as $t,a as Yt}from"./useTable-C-JI8HsX.js";import{c as Mt,e as At,f as Nt,s as Ot,h as Ne,i as Bt,a as Et,j as Lt,k as Ce,l as Ut}from"./schedule-eMs4Cjr4.js";import{f as qt}from"./index-2NxJnuEc.js";const Pt={class:"form-item-margin"},jt={class:"left-part"},Rt=["onMouseenter"],Ft={key:0},Vt={class:"schedules-tag-total",style:{"max-width":"700px"}},zt=["onClick"],Gt={class:"schedule-list"},Jt={class:"fixed-header"},Kt={class:"header-title-row"},Qt={class:"header-actions"},Wt={class:"schedule-tip"},Xt={class:"master-checkbox-row"},Zt={class:"scrollable-content"},eo=["onClick"],to={class:"schedule-time"},oo={class:"conflict-tags"},so={key:0,class:"no-data"},lo={class:"right-part"},ao={class:"schedule-container"},no={class:"schedule-header-fixed"},ro={class:"batch-actions-row"},io={class:"schedule-content-scrollable"},co={key:0},uo={class:"stage-header"},mo=["onClick"],fo={class:"schedule-content"},go=["onClick"],vo={key:1,class:"no-data"},ho={class:"right-part"},po={class:"teacher-schedule-container"},To={class:"teacher-schedule-content-scrollable"},yo={key:0},bo={key:1,class:"no-data"},_o=bt({__name:"AddSchedule",emits:["refreshList"],setup(wo,{expose:Oe,emit:Be}){const{rolePage:ko,tableList:Co,columns:So,tableHeight:Do,listParm:Z,getList:Ee}=$t(),{roomOptions:Le,teacherOptions:Ue,courseOptions:Ho,courseOptionsPaike:qe,filterCourseOption:Pe,filterRoomOption:je,filterTeacheroption:Re}=Yt(Ee,Z),{dialog:V,onShow:Fe,onClose:Ve}=It(),ee=b(1),Se={1:[{beginTime:"09:00",endTime:"10:00",duration:60},{beginTime:"10:30",endTime:"11:30",duration:60},{beginTime:"14:00",endTime:"15:00",duration:60},{beginTime:"15:30",endTime:"16:30",duration:60},{beginTime:"17:00",endTime:"18:00",duration:60},{beginTime:"19:00",endTime:"20:00",duration:60},{beginTime:"20:30",endTime:"21:30",duration:60}],2:[{beginTime:"13:00",endTime:"14:00",duration:60},{beginTime:"19:00",endTime:"20:00",duration:60},{beginTime:"20:30",endTime:"21:30",duration:60}],3:[{beginTime:"09:00",endTime:"10:00",duration:60},{beginTime:"10:30",endTime:"11:30",duration:60},{beginTime:"14:00",endTime:"15:00",duration:60},{beginTime:"15:30",endTime:"16:30",duration:60},{beginTime:"17:00",endTime:"18:00",duration:60}]},ze=()=>{a.schedules=[];const t=Se[ee.value];t&&(a.schedules=[...t]),ee.value===1?a.weeks=[1,2,3,4,5,6,7]:ee.value===2?a.weeks=[1,2,3,4,5]:ee.value===3&&(a.weeks=[6,7])};Oe({show:()=>{Je(),oe.value=void 0,a.beginTime=g(A.value,"HH:mm").format("HH:mm"),a.endTime=g(O.value,"HH:mm").format("HH:mm"),a.duration=E.value,a.schedules=[...Se[1]],a.weeks=[1,2,3,4,5,6,7],a.stageId=null,V.title="排课",V.height=530,V.width=1700,Fe()}});const a=ke({courseId:"",teacherId:"",roomId:"",startDate:"",endDate:"",weeks:[1,2,3,4,5,6,7],beginTime:"",endTime:"",duration:0,isMergeClasses:0,schedules:[],lessonName:"",stageId:null}),Ge=ke({weeks:[{required:!0,message:"请选择星期几",trigger:"change"}],startDate:[{required:!0,message:"请选择日期",trigger:"change"}],roomId:[{required:!0,message:"请选择教室",trigger:"change"}],teacherId:[{required:!0,message:"请选择教师",trigger:"change"}],courseId:[{required:!0,message:"请选择课程",trigger:"change"}],duration:[{required:!0,message:"请选择课程时长",trigger:"change"}],beginTime:[{required:!0,message:"请选择上课时间",trigger:"change"}]}),{resetFields:Je,validate:Ke,validateInfos:te}=qt.useForm(a,Ge),oe=b(),Qe=(t,e)=>{console.log("日期："+t,e),a.startDate=e[0],a.endDate=e[1]},We=[{label:"星期一",value:1},{label:"星期二",value:2},{label:"星期三",value:3},{label:"星期四",value:4},{label:"星期五",value:5},{label:"星期六",value:6},{label:"星期日",value:7}],A=b(g("08:00","HH:mm")),Xe=()=>{me()},E=b(60),O=b(null),Ze=t=>{if(t&&A.value){const e=g(A.value,"HH:mm"),o=g(t,"HH:mm");if(o.isBefore(e))T.error("下课时间不能早于上课时间"),O.value=e.add(E.value,"minute");else{const s=o.diff(e,"minutes");E.value=s}}},me=()=>{A.value&&(O.value=g(A.value,"HH:mm").add(E.value,"minute"),a.beginTime=g(A.value,"HH:mm").format("HH:mm"),a.endTime=O.value?O.value.format("HH:mm"):"",a.duration=E.value)},De=Be,q=b(!1),N=b([]),pe=b([]),ae=b([]),He=b([]),P=b([]),S=b([]),ne=b(!1),fe=b(!1),Ie=de(()=>{const t={};return N.value&&N.value.forEach(e=>{let o="无阶段";e.lessonName.includes("精讲")?o="精讲":e.lessonName.includes("密训")?o="密训":e.lessonName.includes("真题")?o="真题":e.lessonName.includes("考点")?o="考点":e.lessonName.includes("其他")&&(o="其他"),t[o]||(t[o]=[]),t[o].push(e)}),t}),ge=async t=>{console.log(`selected ${t}`);const e={...Z,courseId:t};Object.keys(D).forEach(o=>{D[o]=!1}),j.value=!1,G.value=!1;try{if(t!==""&&t!==null&&t!==void 0){const o=await Ne(e);o&&o.code===200&&(console.log("该课程已排时间:"+JSON.stringify(o.data)),N.value=o.data),await ht(t.toString()),await Tt(t.toString());const s=await pt(t.toString());_e.value=s,console.log("触发推荐课时重新计算")}else N.value=[],ce.value=[],_e.value=[],P.value=[];if(t!==""&&t!==null&&t!==void 0){const o={...Z,courseType:t},s=await Bt(o);s&&s.code===200&&(console.log("考期:"+JSON.stringify(s.data)),He.value=s.data)}else He.value=[]}catch(o){console.error("获取课程排程信息失败",o)}},re=async t=>{console.log("教室"),console.log(`selected ${t}`);const e={...Z,roomId:t};try{if(t!==""&&t!==null&&t!==void 0){const o=await At(e);if(o&&o.code===200){const s=new Map;o.data.forEach(l=>{const d=`${l.dateTime}-${l.beginTime}-${l.endTime}`;s.has(d)||s.set(d,l)});const u=Array.from(s.values());u.sort((l,d)=>new Date(l.dateTime).getTime()-new Date(d.dateTime).getTime()),pe.value=u}}else pe.value=[]}catch(o){console.error("获取课程排程信息失败",o)}},ie=async t=>{console.log("教师"),console.log(`selected ${t}`);const e={...Z,teacherId:t};try{if(t!==""&&t!==null&&t!==void 0){const o=await Nt(e);if(o&&o.code===200){const s=new Map;o.data.forEach(l=>{const d=`${l.dateTime}-${l.beginTime}-${l.endTime}`;s.has(d)||s.set(d,l)});const u=Array.from(s.values());u.sort((l,d)=>new Date(l.dateTime).getTime()-new Date(d.dateTime).getTime()),ae.value=u}}else ae.value=[]}catch(o){console.error("获取课程排程信息失败",o)}},et=()=>{if(A.value&&O.value){const t=A.value.format("HH:mm"),e=O.value.format("HH:mm");for(const o of a.schedules){const s=o.beginTime,u=o.endTime;if(t<u&&e>s||t<=s&&e>=u){T.error("时间段重叠，请选择其他时间");return}}a.schedules.push({beginTime:t,endTime:e,duration:E.value}),a.schedules.sort((o,s)=>o.beginTime.localeCompare(s.beginTime)),me()}else T.error("请先选择上课时间和下课时间")},tt=t=>{a.schedules.splice(t,1)},ot=async()=>{Ke().then(async()=>{try{if(xe().length>0){await ft(),De("refreshList");return}T.warning("请先选择要排课的课时")}catch(t){console.log(t),T.error("请求出错，请重试")}finally{q.value=!1}}).catch(t=>{console.log(t),T.error("表单验证失败")})},st=async t=>{Ae.confirm({title:"确认删除",content:"确定要删除这条课程排程吗？",okText:"是",okType:"danger",cancelText:"否",onOk:async()=>{try{const e=await Et(String(t));e&&e.code===200?(T.success("删除成功"),await ge(a.courseId),await ie(a.teacherId),await re(a.roomId)):T.error("删除失败")}catch(e){console.error("删除课程排程失败",e),T.error("请求出错，请重试")}},onCancel(){console.log("取消删除")}})},lt=t=>{if(t.target.checked){const o=[];N.value.forEach(s=>{o.push(s.delId)}),S.value=o}else S.value=[];ve()},at=(t,e)=>{if(e)S.value.includes(t)||S.value.push(t);else{const o=S.value.indexOf(t);o>-1&&S.value.splice(o,1)}ve()},ve=()=>{const t=N.value.length,e=S.value.length;e===0?(ne.value=!1,fe.value=!1):e===t?(ne.value=!0,fe.value=!1):(ne.value=!1,fe.value=!0)},nt=async()=>{if(S.value.length===0){T.warning("请选择要删除的课程排程");return}Ae.confirm({title:"确认批量删除",content:`确定要删除选中的 ${S.value.length} 条课程排程吗？`,okText:"是",okType:"danger",cancelText:"否",onOk:async()=>{try{q.value=!0;const t=await Lt(S.value);t&&t.code===200?(T.success(`批量删除成功，共删除 ${S.value.length} 条记录`),S.value=[],ve(),await ge(a.courseId),await ie(a.teacherId),await re(a.roomId)):T.error(t.msg||"批量删除失败")}catch(t){console.error("批量删除失败",t),T.error("批量删除失败，请重试")}finally{q.value=!1}},onCancel(){console.log("取消批量删除")}})};_t(N,()=>{S.value=[],ve()},{deep:!0});const Te=de(()=>{if(!oe.value||a.schedules.length===0||a.weeks.length===0)return[];const t=oe.value[0],e=oe.value[1],o=[];let s=g(t);const u=g(e),l=_e.value;for(;s.isSame(u)||s.isBefore(u);){const d=s.format("YYYY-MM-DD");let y=s.day()===0?7:s.day();if(a.weeks.includes(y))for(const H of a.schedules){const h=g(d+" "+H.beginTime,"YYYY-MM-DD HH:mm"),$=g(d+" "+H.endTime,"YYYY-MM-DD HH:mm");let R=!1,F=!1,B=!1,Y=!1;for(const c of N.value){const f=g(c.dateTime+" "+c.beginTime,"YYYY-MM-DD HH:mm"),p=g(c.dateTime+" "+c.endTime,"YYYY-MM-DD HH:mm");if(h.isSame(f)&&$.isSame(p)||h.isBefore(p)&&$.isAfter(f)||h.isAfter(f)&&h.isBefore(p)){B=!0;break}}for(const c of l)if(c.isTermCourse===!0)try{const f=typeof c.dateTime=="object"?g(c.dateTime).format("YYYY-MM-DD"):String(c.dateTime),p=typeof c.beginTime=="object"?g(c.beginTime).format("HH:mm:ss"):String(c.beginTime),J=typeof c.endTime=="object"?g(c.endTime).format("HH:mm:ss"):String(c.endTime),n=g(`${f} ${p}`),I=g(`${f} ${J}`);if(h.isBefore(I)&&$.isAfter(n)){console.log(`检测到考期冲突: ${h.format("YYYY-MM-DD HH:mm")} - ${$.format("HH:mm")} 与 ${c.termName||"未知考期"} 课程冲突: ${f} ${p} - ${J}`),Y=!0;break}}catch(f){console.error("处理考期日期时间出错:",f,c)}for(const c of P.value)try{const f=c.dateTime,p=c.beginTime,J=c.endTime,n=g(`${f} ${p}`,"YYYY-MM-DD HH:mm"),I=g(`${f} ${J}`,"YYYY-MM-DD HH:mm");if(h.isBefore(I)&&$.isAfter(n)){console.log(`检测到考期冲突: ${h.format("YYYY-MM-DD HH:mm")} - ${$.format("HH:mm")} 与 ${c.courseType||"未知考期"} 课程冲突: ${f} ${p} - ${J}`),Y=!0;break}}catch(f){console.error("处理考期已排时间冲突检测出错:",f,c)}for(const c of pe.value){const f=g(c.dateTime+" "+c.beginTime,"YYYY-MM-DD HH:mm"),p=g(c.dateTime+" "+c.endTime,"YYYY-MM-DD HH:mm");if(h.isSame(f)&&$.isSame(p)||h.isBefore(p)&&$.isAfter(f)||h.isAfter(f)&&h.isBefore(p)){R=!0;break}}for(const c of ae.value){const f=g(c.dateTime+" "+c.beginTime,"YYYY-MM-DD HH:mm"),p=g(c.dateTime+" "+c.endTime,"YYYY-MM-DD HH:mm");if(h.isSame(f)&&$.isSame(p)||h.isBefore(p)&&$.isAfter(f)||h.isAfter(f)&&h.isBefore(p)){F=!0;break}}if(!B){o.push({schedule:`${d}【${H.beginTime} ~ ${H.endTime}】`,conflicts:{classroom:R,teacher:F,courseTerm:Y}});const c=`${d}【${H.beginTime} ~ ${H.endTime}】`;D[c]===void 0&&(D[c]=!1)}}s=s.add(1,"day")}return o}),rt=async(t,e,o)=>{var s;try{q.value=!0;const l=(N.value.filter(F=>{var f;const B=F.lessonName||"";let Y=null;B.includes("精讲")?Y="精讲":B.includes("密训")?Y="密训":B.includes("真题")?Y="真题":B.includes("考点")?Y="考点":B.includes("其他")&&(Y="其他");const c=a.stageId?(f=se.value.find(p=>p.id===a.stageId))==null?void 0:f.stageName:null;return c?Y===c:!Y||Y==="精讲"}).length+1).toString().padStart(2,"0");let d=a.lessonName;const y=d.indexOf(" - ");y!==-1&&(d=d.substring(0,y));let H=d;const h=a.stageId?(s=se.value.find(F=>F.id===a.stageId))==null?void 0:s.stageName:null;h&&(H+=`${h}`),H+=`${l}`;const $={courseId:a.courseId,roomId:a.roomId,teacherId:a.teacherId,startDate:t,endDate:t,weeks:a.weeks,beginTime:e,endTime:o,duration:E.value,lessonName:H,stageId:a.stageId},R=await Ot($);return R&&R.code==200?(De("refreshList"),a.courseId!==null&&a.courseId!==""&&await ge(a.courseId),await ie(a.teacherId),await re(a.roomId),T.success("添加课时成功"),!0):(T.error(R.msg||"保存失败"),!1)}catch(u){return console.log(u),T.error("请求出错，请重试"),!1}finally{q.value=!1}},ye=t=>{if(!t)return"";const e=["精讲","密训","真题","考点","其他"];for(const o of e){const s=t.indexOf(o);if(s!==-1)return t.substring(s)}return t},it=async(t,e)=>{try{const u=[...e].sort((l,d)=>{const y=new Date(l.dateTime),H=new Date(d.dateTime);return y.getTime()-H.getTime()}).map(l=>`${ye(l.lessonName)}：${l.dateTime}【${l.beginTime.substring(0,5)} ~ ${l.endTime.substring(0,5)}】`).join(`
`);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(u);else{const l=document.createElement("textarea");l.value=u,l.style.position="fixed",l.style.left="-999999px",l.style.top="-999999px",document.body.appendChild(l),l.focus(),l.select(),document.execCommand("copy"),l.remove()}T.success(`已复制${t}阶段的${e.length}个课时`)}catch(o){console.error("复制失败:",o),T.error("复制失败")}};wt(()=>{me(),ct(),$e(()=>{he()})});const se=b([]),ct=async()=>{try{const t=await Mt();t&&t.code===200&&t.data?se.value=t.data:(console.error("Failed to fetch stage options:",t.message),se.value=[])}catch(t){console.error("Error fetching stage options:",t),se.value=[]}},z=b(""),D=ke({}),j=b(!1),G=b(!1),ut=t=>{console.log("搜索内容:",t),z.value=t,$e(()=>{he()})},dt=t=>{const e=D[t]||!1;D[t]=!e,he(),console.log(`切换课时 ${t} 选中状态为: ${!e}`)},mt=t=>{const e=t.target.checked;e?(L.value.forEach(o=>{D[o.schedule]=!0}),console.log(`已全选 ${L.value.length} 节课时`)):(Object.keys(D).forEach(o=>{D[o]=!1}),console.log("已清空所有选择")),j.value=e,G.value=!1},xe=()=>L.value.filter(t=>D[t.schedule]),be=de(()=>Object.values(D).filter(Boolean).length),he=()=>{const t=be.value,e=L.value.length;t===0?(j.value=!1,G.value=!1):t===e&&e>0?(j.value=!0,G.value=!1):(j.value=!1,G.value=!0)},ft=async()=>{const t=xe();if(t.length===0){T.warning("请至少选择一个推荐课时");return}try{q.value=!0;let e=0;for(const o of t){const[s,u]=o.schedule.split("【"),[l,d]=u.replace("】","").split(" ~ ");A.value=g(l,"HH:mm"),O.value=g(d,"HH:mm"),E.value=O.value.diff(A.value,"minute");try{await rt(s,l,d)&&(e++,D[o.schedule]=!1)}catch(y){console.error("排课失败:",y)}}e>0&&(T.success(`成功排课 ${e} 节课时`),await ie(a.teacherId),await re(a.roomId),j.value=!1,G.value=!1,he())}catch(e){console.error("批量排课失败:",e),T.error("批量排课过程中发生错误")}finally{q.value=!1}},gt=async()=>{if(L.value.length===0){T.warning("暂无推荐课时可复制");return}try{const t=L.value.map(e=>{const o=e.schedule,s=[];return e.conflicts.teacher&&s.push("教师冲突"),e.conflicts.classroom&&s.push("教室冲突"),e.conflicts.courseTerm&&s.push("考期冲突"),s.length>0?`${o}${s.join("、")}`:o}).join(`
`);await navigator.clipboard.writeText(t),T.success(`已复制 ${L.value.length} 个推荐课时到剪贴板`)}catch(t){console.error("复制失败:",t),T.error("复制失败，请重试")}},L=de(()=>{console.log("搜索值:",z.value),console.log("推荐课时数量:",Te.value.length);let t=[];return z.value.trim()?t=Te.value.filter(e=>e.schedule.toLowerCase().includes(z.value.toLowerCase())):t=Te.value,t.forEach(e=>{D[e.schedule]===void 0&&(D[e.schedule]=!1)}),console.log("过滤后数量:",t.length),t}),ce=b([]),U=b([]),_e=b([]);de(()=>{const t={};return P.value&&P.value.forEach(e=>{let o=e.courseType||"未知考期";t[o]||(t[o]=[]),t[o].push(e)}),t});const vt=async t=>{console.log("鼠标悬停课程ID:",t);try{if(t){const e=await Ce(t);if(console.log("获取合并课程考期响应:",e),e&&e.code===200)if(console.log("合并课程考期原始数据:",e.data),e.data&&e.data.length>0){const o=new Map;e.data.forEach(s=>{console.log("考期项:",s),o.has(s.courseType)||o.set(s.courseType,s)}),U.value=Array.from(o.values()),console.log("去重后的考期数据:",U.value)}else console.log("API返回数据为空"),U.value=[];else console.warn("API响应错误或无数据:",e),U.value=[]}else console.log("无课程ID，清空考期数据"),U.value=[]}catch(e){console.error("获取合并课程考期信息失败",e),U.value=[]}},ht=async t=>{if(!t){ce.value=[];return}try{const e=await Ce(t);e&&e.code===200&&e.data?ce.value=e.data.map(o=>({courseType:o.courseType})):ce.value=[]}catch(e){console.error("获取合并课程考期失败:",e),ce.value=[]}},pt=async t=>{if(!t)return[];try{const e=await Ce(t);if(e&&e.code===200&&e.data){const o=[...N.value];console.log("获取到合并课程的相关考期数据:",e.data);const s=e.data.map(async u=>{if(u.courseId){const l=u.courseId.toString();console.log("正在获取考期课程数据，课程ID:",l);const d={...Z,courseId:l},y=await Ne(d);if(y&&y.code===200&&y.data)return console.log(`考期 ${u.courseType} 的排课数据:`,y.data),y.data.map(h=>({...h,isTermCourse:!0,termName:u.courseType}))}return[]});try{const u=await Promise.all(s);return console.log("所有考期数据获取结果:",u),u.forEach(l=>{l&&l.length&&o.push(...l)}),console.log("合并后的所有考期排课数据:",o),o}catch(u){return console.error("获取考期排课数据时出错:",u),[...N.value]}}}catch(e){console.error("获取考期排课数据失败:",e)}return[...N.value]},Tt=async t=>{if(!t){P.value=[];return}try{const e=await Ut(t);if(e&&e.code===200){console.log("考期已排时间数据:",e.data);const o=new Map;e.data.forEach(u=>{const l=`${u.dateTime}-${u.beginTime}-${u.endTime}`;o.has(l)||o.set(l,u)});const s=Array.from(o.values());s.sort((u,l)=>new Date(u.dateTime).getTime()-new Date(l.dateTime).getTime()),P.value=s}else P.value=[]}catch(e){console.error("获取考期已排时间失败:",e),P.value=[]}};return(t,e)=>{const o=C("a-tag"),s=C("a-tooltip"),u=C("a-select"),l=C("a-form-item"),d=C("a-col"),y=C("a-row"),H=C("a-checkbox-group"),h=C("a-radio"),$=C("a-radio-group"),R=C("a-select-option"),F=C("a-range-picker"),B=C("a-time-picker"),Y=C("a-input-number"),c=C("a-button"),f=C("a-input-search"),p=C("a-checkbox"),J=C("a-form");return v(),K(xt,{title:_(V).title,height:_(V).height,width:_(V).width,visible:_(V).visible,onOnClose:_(Ve),onOnConfirm:ot,destroyOnClose:!0,top:10},{content:i(()=>[r(Ht,{visible:q.value},null,8,["visible"]),r(J,null,{default:i(()=>[m("div",Pt,[m("div",jt,[r(y,null,{default:i(()=>[r(d,{span:24},{default:i(()=>[r(l,le(_(te).courseId,{label:"课程"}),{default:i(()=>[r(u,{value:a.courseId,"onUpdate:value":e[0]||(e[0]=n=>a.courseId=n),"show-search":"",placeholder:"请选择课程",style:{width:"100%"},options:_(qe),"filter-option":_(Pe),allowClear:"",onChange:ge},{option:i(({value:n,courseType:I,label:x,isMergeClasses:we})=>[m("div",{onMouseenter:ue=>vt(n),class:"course-option"},[we==1?(v(),K(o,{key:0,color:"red"},{default:i(()=>e[14]||(e[14]=[M("合并")])),_:1})):Q("",!0),m("span",null,w(x),1),we==1?(v(),K(s,{key:1,placement:"right"},{title:i(()=>[e[15]||(e[15]=m("div",null,[m("strong",null,"合并课程考期：")],-1)),(v(!0),k(X,null,W(U.value,(ue,yt)=>(v(),k("div",{key:yt,class:"term-list-item"},w(ue.courseType),1))),128)),!U.value||U.value.length===0?(v(),k("div",Ft," 正在加载考期信息...")):Q("",!0)]),default:i(()=>[r(_(Ye),{style:{"margin-left":"5px",color:"#1890ff"}})]),_:2},1024)):Q("",!0)],40,Rt)]),_:1},8,["value","options","filter-option"])]),_:1},16)]),_:1})]),_:1}),r(y,null,{default:i(()=>[r(d,{span:12},{default:i(()=>[r(l,le(_(te).roomId,{labelCol:{style:"width:80px;"},label:"教室"}),{default:i(()=>[r(u,{value:a.roomId,"onUpdate:value":e[1]||(e[1]=n=>a.roomId=n),"show-search":"",placeholder:"请选择教室",style:{width:"200px"},options:_(Le),allowClear:"","filter-option":_(je),onChange:re},null,8,["value","options","filter-option"])]),_:1},16)]),_:1}),r(d,{span:12},{default:i(()=>[r(l,le(_(te).teacherId,{labelCol:{style:"width:80px;"},label:"教师"}),{default:i(()=>[r(u,{value:a.teacherId,"onUpdate:value":e[2]||(e[2]=n=>a.teacherId=n),"show-search":"",placeholder:"请选择教师",style:{width:"200px"},options:_(Ue),allowClear:"","filter-option":_(Re),onChange:ie},null,8,["value","options","filter-option"])]),_:1},16)]),_:1})]),_:1}),r(l,le(_(te).weeks,{labelCol:{style:"width:80px;"},label:"星期"}),{default:i(()=>[r(H,{options:We,value:a.weeks,"onUpdate:value":e[3]||(e[3]=n=>a.weeks=n)},null,8,["value"])]),_:1},16),r(l,{label:"时间段组",labelCol:{style:"width:80px;"}},{default:i(()=>[r($,{value:ee.value,"onUpdate:value":e[4]||(e[4]=n=>ee.value=n),onChange:ze},{default:i(()=>[r(h,{value:1},{default:i(()=>e[16]||(e[16]=[M("全天班")])),_:1}),r(h,{value:2},{default:i(()=>e[17]||(e[17]=[M("周一至周五晚班")])),_:1}),r(h,{value:3},{default:i(()=>e[18]||(e[18]=[M("周末班")])),_:1})]),_:1},8,["value"])]),_:1}),r(y,null,{default:i(()=>[r(d,{span:24},{default:i(()=>[r(l,{label:"阶段名称",labelCol:{style:"width:80px;"}},{default:i(()=>[r(u,{value:a.stageId,"onUpdate:value":e[5]||(e[5]=n=>a.stageId=n),placeholder:"请选择阶段 (可选)",style:{width:"200px"},allowClear:""},{default:i(()=>[(v(!0),k(X,null,W(se.value,n=>(v(),K(R,{key:n.id,value:n.id},{default:i(()=>[M(w(n.stageName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),r(l,le(_(te).startDate,{labelCol:{style:"width:80px;"},label:"上课日期"}),{default:i(()=>[r(F,{value:oe.value,"onUpdate:value":e[6]||(e[6]=n=>oe.value=n),format:"YYYY-MM-DD",placeholder:["开始时间","结束时间"],onChange:Qe},null,8,["value"])]),_:1},16),r(y,null,{default:i(()=>[r(d,null,{default:i(()=>[r(l,le(_(te).beginTime,{label:"上课时间"}),{default:i(()=>[r(B,{minuteStep:5,onChange:Xe,value:A.value,"onUpdate:value":e[7]||(e[7]=n=>A.value=n),format:"HH:mm"},null,8,["value"])]),_:1},16)]),_:1}),r(d,{style:{"margin-left":"5px"}},{default:i(()=>[r(l,{label:"课程时长"},{default:i(()=>[r(Y,{value:E.value,"onUpdate:value":e[8]||(e[8]=n=>E.value=n),onChange:me},null,8,["value"])]),_:1})]),_:1}),r(d,{style:{"margin-left":"5px"}},{default:i(()=>[r(l,{label:"下课时间"},{default:i(()=>[r(B,{value:O.value,"onUpdate:value":e[9]||(e[9]=n=>O.value=n),format:"HH:mm",onChange:Ze},null,8,["value"])]),_:1})]),_:1}),r(d,{style:{"margin-left":"5px"}},{default:i(()=>[r(c,{type:"primary",onClick:et},{default:i(()=>e[19]||(e[19]=[M("添加时间段")])),_:1})]),_:1})]),_:1}),r(y,null,{default:i(()=>[m("div",Vt,[r(d,{span:24},{default:i(()=>[(v(!0),k(X,null,W(a.schedules,(n,I)=>(v(),k("div",{key:I,class:"schedule-tag"},[M(w(n.beginTime)+" ~ "+w(n.endTime)+" ",1),m("span",{class:"delete-btn",onClick:x=>tt(I)},"x",8,zt)]))),128))]),_:1})])]),_:1})]),m("div",Gt,[m("div",Jt,[m("div",Kt,[e[20]||(e[20]=m("h3",null,"推荐课时",-1)),m("div",Qt,[r(s,{placement:"top",title:"复制全部推荐课时"},{default:i(()=>[r(_(Me),{class:"copy-all-icon",onClick:gt,style:kt({color:L.value.length>0?"#1890ff":"#d9d9d9"})},null,8,["style"])]),_:1})])]),m("div",Wt,[r(s,{placement:"right"},{title:i(()=>e[21]||(e[21]=[m("span",null,"选择课时，然后点击“确定”按钮进行批量排课",-1)])),default:i(()=>[r(_(Ye),{style:{color:"#1890ff","margin-left":"5px"}})]),_:1})]),r(f,{value:z.value,"onUpdate:value":e[10]||(e[10]=n=>z.value=n),placeholder:"搜索课时",style:{"margin-bottom":"10px",width:"100%"},onSearch:ut,allowClear:""},null,8,["value"]),m("div",Xt,[r(p,{checked:j.value,"onUpdate:checked":e[11]||(e[11]=n=>j.value=n),onChange:mt,indeterminate:G.value},{default:i(()=>e[22]||(e[22]=[M(" 全选 ")])),_:1},8,["checked","indeterminate"]),m("div",{class:Ct(["selection-count",{"has-selected":be.value>0}])}," 已选择 "+w(be.value)+" 节课时 ",3)])]),m("div",Zt,[r(l,{label:""},{default:i(()=>[(v(!0),k(X,null,W(L.value,(n,I)=>(v(),k("div",{key:I,class:"recommended-schedule-item"},[r(p,{value:n.schedule,checked:D[n.schedule],"onUpdate:checked":x=>D[n.schedule]=x,class:"schedule-checkbox",onClick:e[12]||(e[12]=St(()=>{},["stop"]))},null,8,["value","checked","onUpdate:checked"]),m("div",{class:"schedule-content",onClick:x=>dt(n.schedule)},[m("div",to,w(n.schedule),1),m("div",oo,[n.conflicts.classroom?(v(),K(o,{key:0,color:"red"},{default:i(()=>e[23]||(e[23]=[M("教室冲突")])),_:1})):Q("",!0),n.conflicts.teacher?(v(),K(o,{key:1,color:"red"},{default:i(()=>e[24]||(e[24]=[M("教师冲突")])),_:1})):Q("",!0),n.conflicts.courseTerm?(v(),K(o,{key:2,color:"red",class:"course-term-conflict"},{default:i(()=>e[25]||(e[25]=[M("考期冲突")])),_:1})):Q("",!0)])],8,eo)]))),128)),L.value.length===0?(v(),k("div",so,w(z.value?"无匹配结果":"暂无推荐课时"),1)):Q("",!0)]),_:1})])]),m("div",lo,[m("div",ao,[m("div",no,[e[27]||(e[27]=m("h3",null,"该课程已排时间",-1)),m("div",ro,[r(p,{checked:ne.value,"onUpdate:checked":e[13]||(e[13]=n=>ne.value=n),onChange:lt,indeterminate:fe.value},{default:i(()=>e[26]||(e[26]=[M(" 全选 ")])),_:1},8,["checked","indeterminate"]),r(c,{type:"primary",danger:"",size:"small",disabled:S.value.length===0,onClick:nt},{default:i(()=>[M(" 批量删除 ("+w(S.value.length)+") ",1)]),_:1},8,["disabled"])])]),m("div",io,[Object.keys(Ie.value).length>0?(v(),k("ul",co,[(v(!0),k(X,null,W(Ie.value,(n,I)=>(v(),k("li",{key:I},[m("h4",uo,[M(w(I)+" ("+w(n.length)+") ",1),m("span",{class:"copy-btn",onClick:x=>it(I,n),title:"复制整个阶段"},[r(_(Me))],8,mo)]),m("ul",null,[(v(!0),k(X,null,W(n,(x,we)=>(v(),k("li",{key:x.delId,class:"schedule-item"},[r(p,{checked:S.value.includes(String(x.delId)),onChange:ue=>at(String(x.delId),ue.target.checked)},null,8,["checked","onChange"]),m("span",fo,w(ye(x.lessonName))+"："+w(x.dateTime)+"【"+w(x.beginTime.substring(0,5))+" ~ "+w(x.endTime.substring(0,5))+"】 ",1),m("span",{class:"delete-btn",onClick:ue=>st(x.delId)},"x",8,go)]))),128))])]))),128))])):(v(),k("div",vo," 暂无课程已排课时 "))])])]),m("div",ho,[m("div",po,[e[28]||(e[28]=m("div",{class:"teacher-schedule-header-fixed"},[m("h3",null,"教师已排时间")],-1)),m("div",To,[ae.value.length>0?(v(),k("ul",yo,[(v(!0),k(X,null,W(ae.value,(n,I)=>(v(),k("li",{key:I,class:"teacher-schedule-item"},w(ye(n.lessonName))+"："+w(n.dateTime)+"【"+w(n.beginTime.substring(0,5))+" ~ "+w(n.endTime.substring(0,5))+"】 ",1))),128))])):(v(),k("div",bo," 暂无教师已排课时 "))])])])])]),_:1})]),_:1},8,["title","height","width","visible","onOnClose"])}}}),Oo=Dt(_o,[["__scopeId","data-v-6e9d8036"]]);export{Oo as default};
