import{u as J,_ as V}from"./useDialog-Dl2BjXS6.js";import{d as $,a as x,r as _,b as c,o as G,c as K,z as Q,w as o,u as s,A as g,g as m,f as t,J as T}from"./index-DFxeWJFZ.js";import{f as W}from"./index-2NxJnuEc.js";import{u as X,a as Z}from"./useTable-C-JI8HsX.js";import{u as ee}from"./schedule-eMs4Cjr4.js";const _e=$({__name:"EditSchedule",emits:["refreshList"],setup(ae,{expose:O,emit:k}){const{rolePage:te,tableList:oe,columns:le,tableHeight:ne,listParm:N,getList:Y,loading:re}=X(),{roomOptions:U,teacherOptions:D,courseOptions:se,courseOptionsPaike:ie,filterCourseOption:ue,filterRoomOption:M,filterTeacheroption:P}=Z(Y,N),{dialog:f,onShow:q,onClose:H}=J();O({show:(i,a)=>{f.height=300,f.width=700,q(),f.title="编辑",a&&(Object.assign(e,a),u.value=c(a.beginTime,"HH:mm"),v.value=a.duration,d.value=c(a.endTime,"HH:mm"))}});const e=x({id:0,roomId:0,courseId:"",teacherId:"",dateTime:"",beginTime:"",duration:0,endTime:"",courseType:"",majorName:"",courseYear:"",teacherName:"",courseName:"",roomName:"",courseColor:"",roomAddress:"",startDate:"",endDate:"",delId:0}),I=x({roomId:[{required:!0,message:"请选择教室",trigger:"change"}],teacherId:[{required:!0,message:"请选择教师",trigger:"change"}],courseId:[{required:!0,message:"请选择课程",trigger:"change"}],dateTime:[{required:!0,message:"请选择上课日期",trigger:"change"}],duration:[{required:!0,type:"number",min:1,message:"请输入有效的课程时长",trigger:"change"}]}),{resetFields:de,validate:L,validateInfos:b}=W.useForm(e,I);_();const j=()=>{y()},d=_(),u=_(c("08:00","HH:mm")),v=_(),A=i=>{if(i&&u.value){const a=c(u.value,"HH:mm"),r=c(i,"HH:mm");if(r.isBefore(a))g.error("下课时间不能早于上课时间"),d.value=a.add(v.value||0,"minute");else{const l=r.diff(a,"minutes");v.value=l}}},y=()=>{const i=v.value??0;d.value=c(u.value,"HH:mm").add(i,"minute"),e.beginTime=c(u.value,"HH:mm").format("HH:mm"),e.endTime=c(d.value,"HH:mm").format("HH:mm"),e.duration=i},B=k,F=async()=>{var i,a;try{await L(),u.value&&d.value&&(e.beginTime=u.value.format("HH:mm"),e.endTime=d.value.format("HH:mm"),e.duration=v.value||0);const r={id:e.id,roomId:e.roomId,teacherId:e.teacherId,dateTime:e.dateTime,beginTime:e.beginTime,duration:e.duration,endTime:e.endTime,courseId:e.courseId,courseType:e.courseType,delId:e.delId},l=await ee(r);l&&l.code===200?(g.success(l.msg||"编辑成功"),H(),B("refreshList")):g.error(l.msg||"编辑失败")}catch(r){console.error("保存失败:",r),(a=(i=r.response)==null?void 0:i.data)!=null&&a.msg?g.error(r.response.data.msg):r.errorFields?g.error("请检查表单填写是否完整"):g.error("保存失败，请稍后重试")}},R=_();return G(()=>{}),(i,a)=>{const r=m("a-input"),l=m("a-form-item"),p=m("a-col"),h=m("a-row"),C=m("a-select"),S=m("a-date-picker"),w=m("a-time-picker"),E=m("a-input-number"),z=m("a-form");return K(),Q(V,{title:s(f).title,height:s(f).height,width:s(f).width,visible:s(f).visible,onOnClose:s(H),onOnConfirm:F,destroyOnClose:!0},{content:o(()=>[t(z,{model:e,rules:I,ref_key:"formRef",ref:R},{default:o(()=>[t(h,null,{default:o(()=>[t(p,{span:24},{default:o(()=>[t(l,{label:"课程名称",name:"courseName"},{default:o(()=>[t(r,{value:e.courseName,"onUpdate:value":a[0]||(a[0]=n=>e.courseName=n),placeholder:"请输入课程名称",disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(h,null,{default:o(()=>[t(p,{span:12},{default:o(()=>[t(l,T(s(b).roomId,{labelCol:{style:"width:80px;"},label:"教室"}),{default:o(()=>[t(C,{value:e.roomId,"onUpdate:value":a[1]||(a[1]=n=>e.roomId=n),"show-search":"",placeholder:"请选择教室",style:{width:"200px"},options:s(U),"filter-option":s(M)},null,8,["value","options","filter-option"])]),_:1},16)]),_:1}),t(p,{span:12},{default:o(()=>[t(l,T(s(b).teacherId,{labelCol:{style:"width:80px;"},label:"教师"}),{default:o(()=>[t(C,{value:e.teacherId,"onUpdate:value":a[2]||(a[2]=n=>e.teacherId=n),"show-search":"",placeholder:"请选择教师",style:{width:"200px"},options:s(D),"filter-option":s(P)},null,8,["value","options","filter-option"])]),_:1},16)]),_:1})]),_:1}),t(h,null,{default:o(()=>[t(p,{span:12},{default:o(()=>[t(l,{label:"考期",name:"courseType",labelCol:{style:"width:80px;"}},{default:o(()=>[t(r,{style:{width:"200px"},value:e.courseType,"onUpdate:value":a[3]||(a[3]=n=>e.courseType=n),disabled:"",placeholder:"请输入考期"},null,8,["value"])]),_:1})]),_:1}),t(p,{span:12},{default:o(()=>[t(l,{label:"上课日期",name:"dateTime",labelCol:{style:"width:80px;"}},{default:o(()=>[t(S,{style:{width:"200px"},value:e.dateTime,"onUpdate:value":a[4]||(a[4]=n=>e.dateTime=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"请选择上课日期","show-time-picker":"false"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(h,null,{default:o(()=>[t(p,{span:8},{default:o(()=>[t(l,T(s(b).beginTime,{label:"上课时间"}),{default:o(()=>[t(w,{minuteStep:5,onChange:j,value:u.value,"onUpdate:value":a[5]||(a[5]=n=>u.value=n),format:"HH:mm"},null,8,["value"])]),_:1},16)]),_:1}),t(p,{span:8},{default:o(()=>[t(l,{label:"课程时长"},{default:o(()=>[t(E,{value:v.value,"onUpdate:value":a[6]||(a[6]=n=>v.value=n),onChange:y},null,8,["value"])]),_:1})]),_:1}),t(p,{span:8},{default:o(()=>[t(l,{label:"下课时间"},{default:o(()=>[t(w,{value:d.value,"onUpdate:value":a[7]||(a[7]=n=>d.value=n),format:"HH:mm",onChange:A},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","height","width","visible","onOnClose"])}}});export{_e as _};
