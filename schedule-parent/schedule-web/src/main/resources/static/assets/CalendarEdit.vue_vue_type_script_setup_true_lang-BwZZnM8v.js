import{u as ae,_ as ie}from"./useDialog-Dl2BjXS6.js";import{E as ne,T as U}from"./BaseEnum-DZksv6ke.js";import{u as ue,a as se}from"./useTable-C-JI8HsX.js";import{d as re,r as b,a as M,L as H,c as I,z as x,w as a,u,b as r,A as f,N as Y,g as p,f as o,J as g,i as A}from"./index-DFxeWJFZ.js";import{u as de}from"./useInstance-MikN16Nm.js";import{m as me,u as pe,d as ce}from"./schedule-eMs4Cjr4.js";import{f as fe}from"./index-2NxJnuEc.js";const ke=re({__name:"CalendarEdit",emits:["upSuccess"],setup(ve,{expose:S,emit:q}){const{global:N}=de(),{dialog:c,onClose:T,onShow:E}=ae(),{rolePage:ge,tableList:_e,columns:he,tableHeight:be,listParm:L,getList:P}=ue(),{roomOptions:j,teacherOptions:F,courseOptions:V,filterCourseOption:$,filterRoomOption:z,filterTeacheroption:J}=se(P,L),_=b("add"),R=(t,e)=>{G(),h.value=void 0,n.value=void 0,i.value=void 0,c.width=700,c.height=350,t===ne.ADD?(c.title=U.ADD,_.value="add",l.duration=60,e!=null&&e.dateTime&&(h.value=r(e.dateTime),l.dateTime=e.dateTime),e!=null&&e.beginTime&&(n.value=r(e.beginTime,"HH:mm"),l.beginTime=e.beginTime,n.value&&(i.value=r(n.value).add(60,"minute"),l.endTime=i.value.format("HH:mm")))):(c.title=U.EDIT,_.value="edit",N.$objCoppy(e,l),h.value=r(e==null?void 0:e.dateTime,"YYYY-MM-DD"),n.value=r(e==null?void 0:e.beginTime,"HH:mm"),i.value=r(e==null?void 0:e.endTime,"HH:mm")),E()},l=M({id:"",dateTime:"",roomId:"",teacherId:"",courseId:"",beginTime:"",endTime:"",duration:0,courseType:"",lessonNumber:""}),B=M({dateTime:[{required:!0,message:"请选择日期",trigger:"change"}],roomId:[{required:!0,message:"请选择教室",trigger:"change"}],teacherId:[{required:!0,message:"请选择教师",trigger:"change"}],courseId:[{required:!0,message:"请选择课程",trigger:"change"}],duration:[{required:!0,message:"请选择课程时长",trigger:"change"}],beginTime:[{required:!0,message:"请选择上课时间",trigger:"change"}]}),{resetFields:G,validate:K,validateInfos:v}=fe.useForm(l,B),h=b(),Q=(t,e)=>{console.log(t),console.log(e),l.dateTime=e},n=b(),W=()=>{l.duration&&k(),i.value&&n.value&&i.value.isBefore(n.value)&&(i.value=r(n.value).add(l.duration,"minute"),l.endTime=i.value.format("HH:mm"))};b(0);const i=b(),k=()=>{n.value&&l.duration&&(i.value=r(n.value).add(l.duration,"minute"),l.endTime=i.value.format("HH:mm"))};S({editCalender:R});const y=q;H(()=>l.duration,t=>{n.value&&t&&(i.value=r(n.value).add(t,"minute"),l.endTime=i.value.format("HH:mm"))}),H(i,t=>{if(n.value&&t){const e=t.diff(n.value,"minute");l.duration=e}}),H(n,t=>{t&&(l.beginTime=t.format("HH:mm"),i.value&&t.isAfter(i.value)&&(i.value=r(t).add(l.duration,"minute"),l.endTime=i.value.format("HH:mm")),l.duration&&k())});const X=()=>{if(n.value&&i.value){const t=i.value.diff(n.value,"minute");l.duration=t}},Z=()=>{K().then(async()=>{try{let t=null;_.value==="add"?(t=await me(l),t&&t.code==200?(f.success("新增成功"),y("upSuccess"),T()):f.error((t==null?void 0:t.msg)||"新增失败")):Y.confirm({title:"确认修改",content:"确定要修改这条课程排程吗？",okText:"是",cancelText:"否",async onOk(){t=await pe(l),t&&t.code==200?(f.success("修改成功"),y("upSuccess"),T()):f.error((t==null?void 0:t.msg)||"修改失败")}})}catch(t){console.error("操作失败",t),f.error("请求出错，请重试")}})},ee=()=>{Y.confirm({title:"确认删除",content:"确定要删除这条课程排程吗？",okText:"是",okType:"danger",cancelText:"否",async onOk(){try{const t=await ce(String(l.id));t&&t.code===200?(f.success("删除成功"),y("upSuccess"),T()):f.error(t.msg||"删除失败")}catch(t){console.error("删除课程排程失败",t),f.error("请求出错，请重试")}}})};return(t,e)=>{const C=p("a-select"),d=p("a-form-item"),m=p("a-col"),w=p("a-row"),O=p("a-input"),te=p("a-date-picker"),D=p("a-time-picker"),le=p("a-input-number"),oe=p("a-form");return I(),x(ie,{title:u(c).title,width:u(c).width,height:u(c).height,visible:u(c).visible,onOnClose:u(T),onOnConfirm:Z,onOnDelete:ee,mode:_.value,destroyOnClose:!0},{content:a(()=>[o(oe,{style:{"margin-right":"30px"}},{default:a(()=>[o(w,null,{default:a(()=>[o(m,{span:24},{default:a(()=>[o(d,g(u(v).courseId,{labelCol:{style:"width:80px;"},label:"课程"}),{default:a(()=>[o(C,{value:l.courseId,"onUpdate:value":e[0]||(e[0]=s=>l.courseId=s),"show-search":"",placeholder:"请选择课程",style:{width:"100%"},options:u(V),"filter-option":u($)},null,8,["value","options","filter-option"])]),_:1},16)]),_:1})]),_:1}),_.value==="edit"?(I(),x(w,{key:0},{default:a(()=>[o(m,{span:24},{default:a(()=>[o(d,{labelCol:{style:"width:80px;"},label:"课时"},{default:a(()=>[o(O,{value:l.lessonNumber,"onUpdate:value":e[1]||(e[1]=s=>l.lessonNumber=s),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1})):A("",!0),o(w,null,{default:a(()=>[o(m,{span:12},{default:a(()=>[o(d,g(u(v).dateTime,{labelCol:{style:"width:80px;"},label:"日期"}),{default:a(()=>[o(te,{style:{width:"100%"},format:"YYYY-MM-DD",onChange:Q,value:h.value,"onUpdate:value":e[2]||(e[2]=s=>h.value=s)},null,8,["value"])]),_:1},16)]),_:1}),o(m,{span:12},{default:a(()=>[o(d,g(u(v).roomId,{labelCol:{style:"width:80px;"},label:"教室"}),{default:a(()=>[o(C,{value:l.roomId,"onUpdate:value":e[3]||(e[3]=s=>l.roomId=s),"show-search":"",placeholder:"请选择教室",style:{width:"100%"},options:u(j),"filter-option":u(z)},null,8,["value","options","filter-option"])]),_:1},16)]),_:1}),o(m,{span:12},{default:a(()=>[o(d,g(u(v).teacherId,{labelCol:{style:"width:80px;"},label:"教师"}),{default:a(()=>[o(C,{value:l.teacherId,"onUpdate:value":e[4]||(e[4]=s=>l.teacherId=s),"show-search":"",placeholder:"请选择教师",style:{width:"100%"},options:u(F),"filter-option":u(J)},null,8,["value","options","filter-option"])]),_:1},16)]),_:1}),_.value==="edit"?(I(),x(m,{key:0,span:12},{default:a(()=>[o(d,g(u(v).course_type,{labelCol:{style:"width:80px;"},label:"考期"}),{default:a(()=>[o(O,{value:l.courseType,"onUpdate:value":e[5]||(e[5]=s=>l.courseType=s),disabled:""},null,8,["value"])]),_:1},16)]),_:1})):A("",!0),o(m,{span:12},{default:a(()=>[o(d,g(u(v).beginTime,{labelCol:{style:"width:80px;"},label:"上课时间"}),{default:a(()=>[o(D,{style:{width:"100%"},minuteStep:5,onChange:W,value:n.value,"onUpdate:value":e[6]||(e[6]=s=>n.value=s),format:"HH:mm"},null,8,["value"])]),_:1},16)]),_:1}),o(m,{span:12},{default:a(()=>[o(d,g(u(v).duration,{labelCol:{style:"width:80px;"},label:"课程时长"}),{default:a(()=>[o(le,{style:{width:"100%"},value:l.duration,"onUpdate:value":e[7]||(e[7]=s=>l.duration=s)},null,8,["value"])]),_:1},16)]),_:1}),o(m,{span:12},{default:a(()=>[o(d,{label:"下课时间",labelCol:{style:"width:80px;"}},{default:a(()=>[o(D,{style:{width:"100%"},minuteStep:5,value:i.value,"onUpdate:value":e[8]||(e[8]=s=>i.value=s),format:"HH:mm",onChange:X},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title","width","height","visible","onOnClose","mode"])}}});export{ke as _};
