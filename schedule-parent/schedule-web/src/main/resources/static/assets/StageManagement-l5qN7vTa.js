import{G as k,r as f,o as H,d as Y,M as j,g as d,c as r,e as u,h as $,f as g,w as v,l as q,u as c,t as I,i as D,z as K,A as _,N as Q,_ as R}from"./index-DFxeWJFZ.js";const W=()=>k.get({url:"/api/stages"}),X=n=>k.put({url:"/api/stages",data:n}),Z=n=>k.delete({url:`/api/stages/${n}`}),ee=n=>k.post({url:"/api/stages",data:n});function te(){const n=f([]),p=f(!1),i=f(null),y=[{title:"阶段名称",dataIndex:"stageName",key:"stageName"},{title:"描述",dataIndex:"description",key:"description"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",align:"center",key:"action",width:150}],m=async()=>{p.value=!0,i.value=null;try{const a=await W();a&&a.code===200&&a.data?n.value=a.data:(i.value=new Error(a.message||"Failed to fetch stages"),console.error("API error fetching stages:",a.message),n.value=[])}catch(a){i.value=a,console.error("Error fetching stages:",a),n.value=[]}finally{p.value=!1}},w=async a=>{try{const e=await X(a);if(e&&e.code===200)return console.log("Stage edited successfully:",e.message),m(),!0;throw console.error("API error editing stage:",e.message),new Error(e.message||"Failed to edit stage")}catch(e){throw console.error("Error editing stage:",e),e}finally{}},S=async a=>{try{const e=await Z(a);if(e&&e.code===200)return console.log("Stage deleted successfully:",e.message),m(),!0;throw console.error("API error deleting stage:",e.message),new Error(e.message||"Failed to delete stage")}catch(e){throw console.error("Error deleting stage:",e),e}finally{}},N=async a=>{try{const e=await ee(a);if(e&&e.code===200)return console.log("Stage added successfully:",e.message),m(),!0;throw console.error("API error adding stage:",e.message),new Error(e.message||"Failed to add stage")}catch(e){throw console.error("Error adding stage:",e),e}finally{}};return H(()=>{m()}),{stages:n,loading:p,error:i,columns:y,fetchStages:m,editStage:w,deleteStage:S,addStage:N}}const ae={style:{"margin-bottom":"16px"}},se={key:0},oe={key:1},ne={key:2},le={key:0},re={key:1},ce={key:2},ie=["onClick"],de=["onClick"],ue={key:0},ge=Y({__name:"StageManagement",setup(n){const{stages:p,loading:i,error:y,columns:m,editStage:w,deleteStage:S,addStage:N}=te(),a=o=>{if(!o)return"";try{const t=new Date(o);if(isNaN(t.getTime()))return console.error("Invalid date string:",o),o;const E=t.getFullYear(),T=("0"+(t.getMonth()+1)).slice(-2),x=("0"+t.getDate()).slice(-2),A=("0"+t.getHours()).slice(-2),h=("0"+t.getMinutes()).slice(-2),C=("0"+t.getSeconds()).slice(-2);return`${E}-${T}-${x} ${A}:${h}:${C}`}catch(t){return console.error("Error formatting date:",t),o}},e=f(!1),s=f(null),b=f(!1),V=j(()=>s.value&&s.value.id!==void 0?"编辑阶段":"添加阶段"),B=()=>{console.log("Add stage"),s.value={stageName:"",description:null},e.value=!0},L=o=>{console.log("Edit stage:",o),s.value=JSON.parse(JSON.stringify(o)),e.value=!0},O=async()=>{if(!s.value||!s.value.stageName){_.warning("阶段名称不能为空");return}b.value=!0;try{if(s.value.id!==void 0)await w(s.value),_.success("阶段编辑成功！");else{const{id:o,...t}=s.value;await N(t),_.success("阶段添加成功！")}e.value=!1,s.value=null}catch(o){_.error(`操作失败: ${o.message||"未知错误"}`)}finally{b.value=!1}},P=()=>{console.log("Modal cancelled"),e.value=!1,s.value=null},U=o=>{console.log("Delete stage:",o),Q.confirm({title:"确认删除",content:`确定要删除阶段 "${o.stageName}" 吗？`,okText:"确定",okType:"danger",cancelText:"取消",onOk:async()=>{try{await S(o.id),_.success("阶段删除成功！")}catch(t){_.error(`删除失败: ${t.message||"未知错误"}`)}},onCancel(){console.log("Delete cancelled")}})};return(o,t)=>{const E=d("a-button"),T=d("a-divider"),x=d("a-table"),A=d("a-input"),h=d("a-form-item"),C=d("a-textarea"),J=d("a-form"),z=d("a-modal");return r(),u("div",null,[$("div",ae,[g(E,{type:"primary",onClick:B},{default:v(()=>t[3]||(t[3]=[q("添加阶段")])),_:1})]),c(i)?(r(),u("div",se,"Loading stages...")):c(y)?(r(),u("div",oe,"Error loading stages: "+I(c(y).message),1)):(r(),u("div",ne,[g(x,{columns:c(m),"data-source":c(p),"row-key":"id",pagination:!1,loading:c(i)},{bodyCell:v(({column:l,text:M,record:F})=>[l.key==="createTime"?(r(),u("span",le,I(a(M)),1)):l.key==="updateTime"?(r(),u("span",re,I(a(M)),1)):l.key==="action"?(r(),u("span",ce,[$("a",{onClick:G=>L(F)},"编辑",8,ie),g(T,{type:"vertical"}),$("a",{onClick:G=>U(F)},"删除",8,de)])):D("",!0)]),_:1},8,["columns","data-source","loading"]),c(p).length===0&&!c(i)&&!c(y)?(r(),u("p",ue,"No stages found.")):D("",!0)])),g(z,{visible:e.value,"onUpdate:visible":t[2]||(t[2]=l=>e.value=l),title:V.value,onOk:O,onCancel:P,confirmLoading:b.value},{default:v(()=>[s.value?(r(),K(J,{key:0,model:s.value,"label-col":{span:5},"wrapper-col":{span:16}},{default:v(()=>[g(h,{label:"阶段名称",name:"stageName"},{default:v(()=>[g(A,{value:s.value.stageName,"onUpdate:value":t[0]||(t[0]=l=>s.value.stageName=l)},null,8,["value"])]),_:1}),g(h,{label:"描述",name:"description"},{default:v(()=>[g(C,{value:s.value.description,"onUpdate:value":t[1]||(t[1]=l=>s.value.description=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])):D("",!0)]),_:1},8,["visible","title","confirmLoading"])])}}}),pe=R(ge,[["__scopeId","data-v-6a5f2e7e"]]);export{pe as default};
